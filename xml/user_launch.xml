<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet
 href="urn:x-daps:xslt:profiling:novdoc-profile.xsl" 
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "IGNORE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<chapter id="cha.user.instances">
 <title>Managing Instances</title>
 <abstract>
  <para>Instances are virtual machines that run inside the cloud. To start
  an instance, you must have a virtual machine image that contains the following 
  information: which operating system to use, a user name and password with which 
  to log in to the &vmguest;, file storage etc. The cloud contains
  a pool of such images that cloud administrators have uploaded and made
  accessible to members of different projects. Apart from the image to use,
  you also need to specify the <quote>size</quote> of the VM to start 
  (called <literal>flavor</literal> in &ostack;) and to provide an SSH key. If 
  you want to make the virtual machine accessible from outside the
	cloud, you need to configure security groups. If needed, block storage
	devices (<literal>volumes</literal>) can be attached to a running
	instance (or detached and attached to another instance at any time).</para>
 </abstract>
 <!--taroth 2012-08-13-->
 <!--basic steps and tasks:
    * create keypair
    * configure security groups
    * launch instance
   [* log in to instance (SSH/VNC)] 
    * create volume
    * attach volume to instance/remove volume from instance
    * terminate/shut down instance
    -->
 <sect1 id="sec.user.instances.keys">
  <title>Creating or Importing Keys</title>
  <para>Before you can launch instances, you need to create a key pair. Keypairs
  are SSH credentials that are injected into images when they are launched.  
 </para>
  <procedure>
   <title>Creating a Keypair with the &cloud; &dash;</title>
   <para>
    <remark>taroth 2012-08-14: DEVs, do I need one keypair per project? or
   one keypair per image to launch?
   </remark>To allow login to an instance via SSH, create a keypair. If you have
   already created a keypair with an external tool, you can import it into
   &ostack;
   </para>
   <step>
    <para>Log in to &cloud; &dash; with your user name and password.</para>
   </step>
   <step>
    <para>If you are a member of multiple projects, select a project from the 
    drop-down list at the top of the <guimenu>Projects</guimenu>
    tab.</para>
   </step>
   <step>
    <para>Click the <guimenu>Access &amp; Security</guimenu> category. The &dash;
    shows <guimenu>Floating IPs</guimenu>, <guimenu>Security Groups</guimenu>, and
    <guimenu>Keypairs</guimenu> for the selected project.</para>
   </step>
   <step>
    <para>To import a keypair that you have generated with an external tool:</para>
    <substeps>
     <step>
      <para>Click <guimenu>Import Keypair</guimenu>.</para>
     </step>
     <step>
      <para>In the window that opens, enter a name for the keypair and
    copy the public key into the respective input field.</para>
     </step>
     <step>
      <para>Confirm your choice to make &ostack; register the public key at
      the Nova database.</para>
     </step>
    </substeps>
   </step>
   <step>
    <para>To create a new keypair:</para>
    <substeps>
     <step>
      <para>Click <guimenu>Create Keypair</guimenu>.</para>
     </step>
     <step>
      <para>In the window that opens, enter a name for the keypair and confirm 
      your choice.</para>
      <para>&ostack; generates a keypair and registers the public key at the Nova
    database. It provides the private key for download as a <filename>*.pem</filename>
    file.</para>
     </step>
     <step>
      <para>Save the <filename>*.pem</filename> file locally and change its 
      permissions so that only you can read and write to the file:</para>
      <screen>chmod 600 <replaceable>MY_PRIV_KEY</replaceable>.pem</screen>
     </step>
    </substeps>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sec.user.instances.launch">
  <title>Launching and Managing Instances</title>
  <para>After you have created or imported a keypair, you are now ready to launch 
    an instance in the cloud.</para>
  <procedure>
   <title>Launching an Instance with the &cloud; &dash;</title>
   <step>
    <para>Log in to &cloud; &dash; with your user name and password.</para>
   </step>
   <step>
    <para>If you are a member of multiple projects, select a project from the 
    drop-down list at the top of the <guimenu>Projects</guimenu>
    tab.</para>
   </step>
   <step>
    <para>Click the <guimenu>Images &amp; Snapshot</guimenu> category. The &dash;
    shows the <guimenu>Images</guimenu> that have been uploaded to Glance and
    are available for this project, plus the <guimenu>Instance Snaphots</guimenu>, 
    and <guimenu>Volume Snapshots</guimenu> for the selected project. 
    </para>
   </step>
   <step>
    <para>Select an image and click <guimenu>Launch</guimenu>.</para>
   </step>
   <step>
    <para>In the window that opens, specify the following:</para>
    <substeps>
     <step>
      <para>Enter a <guimenu>Server Name</guimenu> that will be assigned to the
      virtual machine.</para>
     </step>
     <step>
      <para>From the <guimenu>Flavor</guimenu> drop-down list, select the 
      <quote>size</quote> of the virtual machine to launch.</para>
     </step>
     <step>
      <para>From the <guimenu>Keypair</guimenu> drop-down list,
     select one of the keypairs that you created beforehand. The public key
     will be injected to the image and will allow you to log in to
     the instance via SSH (provided you have allowed SSH access
     in the security group that is assigned to the image).</para>
     </step>
     <step>
      <para>Set the <guimenu>Instance Count</guimenu> to the number of 
     virtual machines to launch from this image.</para>
     </step>
     <step>
      <para>Activate the <guimenu>Security Groups</guimenu> that you want to
      assign to the instance.</para>
      <para>On the right-hand side, a chart shows the resources that are used 
      by any running instances you can check the current quota settings for 
      the project and compare them to the resources that will be used by this 
      instance.</para>
     </step>
     <step>
      <para>If all parameters are set according to your wishes, click 
     <guimenu>Launch Instance</guimenu>. The instance will be started on any of
     the &compnode; in the cloud. The &dash; shows the instance's status in the 
     <guimenu>Instances &amp; Volumes</guimenu> category.
     </para>
     </step>
    </substeps>
   </step>
  </procedure>
  <para>After you have launched an instance, the 
   <guimenu>Instances &amp; Volumes</guimenu> shows the instance's name, its
   (private or public) IP addresses, its size, its status, tasks, and power state.
   To view more details, click the instance's name. It is a link that leads to 
   three tabs:</para>
  <variablelist>
   <varlistentry>
    <term>
     <guimenu>Overview</guimenu>
    </term>
    <listitem>
     <para>Lists additional information about the instance. For example,
     it shows the type of IP addresses that are assigned to an instance (private
     ones are listed as <literal>Nova_Fixed</literal>, public ones are listed
     as <literal>Nova_Fixed</literal>).<remark>taroth 2012-08-16: DEVs, why are 
     floating/public ones also shown as Nova_Fixed? is that meant to be? or a
     bug?</remark>
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>
     <guimenu>Log</guimenu>
    </term>
    <listitem>
     <para>
      <remark>taroth 2012-08-16: DEVs, not sure what this tab shows -
     the output of /var/lib/nova/instances/&lt;instance-number&gt;/console.log?</remark>
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>
     <guimenu>VNC</guimenu>
    </term>
    <listitem>
     <para>Allows you to access the instance via VNC console. 
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <!--taroth 2012-08-16: todos:
  * allocating floating IPs
  * logging in via SSH
  * creating (instance) snapshots
  * pause/suspend instance (+ consequences)
  * reboot/terminate instance (+ consequences)
  -->
  <procedure>
   <title>Managing Instances</title>
   <step>
    <para></para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sec.user.instances.secgroups">
  <title>Configuring Access to the Instances</title>
  <para>In &productname;, security groups are used to define which incoming 
  network traffic should be forwarded to instances. When launching an instance, 
  you need to define which security groups it should belong to. A default 
  security group is available for each project. It allows all network traffic
  from other members of this group and discards traffic from other IP addresses 
  and groups.</para>
  <para>Of course, rules of the default security group can be modified. 
  If necessary, you can also define multiple security groups for a project with 
  each group holding a different set of firewall policies. This is useful if you
  have groups of instances that should differ in firewall configuration (for example,
  front-end and back-end servers). An instance can also be assigned to multiple 
  security groups.</para>
  <para>As soon as the rules for a group a modified, the new rules are automatically 
  applied to all running instances belonging to that security group and to any 
  instances launched from then on.</para>
  <procedure>
   <title>Creating Or Deleting Security Groups with &cloud; &dash;</title>
   <step>
    <para>Log in to &cloud; &dash; with your user name and password.</para>
   </step>
   <step>
    <para>If you are a member of multiple projects, select a project from the 
    drop-down list at the top of the <guimenu>Projects</guimenu>
    tab.</para>
   </step>
   <step>
    <para>Click the <guimenu>Access &amp; Security</guimenu> category. The &dash;
    shows <guimenu>Floating IPs</guimenu>, <guimenu>Security Groups</guimenu>, and
    <guimenu>Keypairs</guimenu> for the selected project.</para>
   </step>
   <step>
    <para>To create a new security group:</para>
    <substeps>
     <step>
      <para>Click <guimenu>Create Security Group</guimenu>. 
     </para>
     </step>
     <step>
      <para>In the window that opens, enter a <guimenu>Name</guimenu> and 
      <guimenu>Description</guimenu> for the group and confirm your changes.</para>
      <para>The &dash; shows the newly created group in the <guimenu>Access &amp; 
      Security</guimenu> category.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     To delete one or multiple security groups:
    </para>
    <substeps>
     <step>
      <para>
       Activate the check boxes in front of the groups that you want to
       delete.
      </para>
     </step>
     <step>
      <para>
       Click <guimenu>Delete Security Groups</guimenu> and confirm your choice in the
       pop-up that appears.
      </para>
      <para>
       A message on the Web page shows if the action has been successful.
      </para>
      <note>
       <title>Deleting Security Groups</title>
       <para>The default security group for a project cannot be deleted.</para>
       <para>
        In case another group cannot be deleted, it is still assigned to a
        running instance.
       </para>
       <orderedlist>
        <listitem>
         <para>Switch to the <guimenu>Instances &amp; Volumes</guimenu> category 
         to view instances that have been launched.
         </para>
        </listitem>
        <listitem>
         <para>Click the instances' name links to view details such as the
         security group that is assigned to the respective instance.
         </para>
        </listitem>
        <listitem>
         <para>Terminate the instance which is member of the security 
        group that you want to delete. Relaunch the instance and assign it to 
        another security group.</para>
        </listitem>
       </orderedlist>
      </note>
     </step>
    </substeps>
   </step>
  </procedure>

  <procedure>
   <title>Configuring Security Group Rules with &cloud; &dash;</title>
   <para>Security rules are specified by the following parameters:</para>
   <itemizedlist>
    <listitem>
     <para>Source of traffic (IP subnet in CIDR notation or another security group)</para>
    </listitem>
    <listitem>
     <para>Protocol (TCP, UDP, ICMP)</para>
    </listitem>
    <listitem>
     <para>Destination port (port range) on virtual machine</para>
    </listitem>
   </itemizedlist>
   <para>If no further security groups have been created, any instances are 
   automatically assigned to the default security group (if not specified
   otherwise). Unless you change the rules for the default group, this means that
   those instances are only accessible from IP addresses belonging to other members 
   of this group and not from any IP addresses outside.
   </para>
   <step>
    <para>Log in to &cloud; &dash; with your user name and password.</para>
   </step>
   <step>
    <para>If you are a member of multiple projects, select a project from the 
    drop-down list at the top of the <guimenu>Projects</guimenu>
    tab.</para>
   </step>
   <step>
    <para>Click the <guimenu>Access &amp; Security</guimenu> category. The &dash;
    shows <guimenu>Floating IPs</guimenu>, <guimenu>Security Groups</guimenu>, and
    <guimenu>Keypairs</guimenu> for the selected project.</para>
   </step>
   <step>
    <para>
     Select the group to modify and click <guimenu>Edit Rules</guimenu>. The window 
     that appears shows which rules have already been configured. 
    </para>
   </step>
   <step>
    <para>To allow SSH access to the instances:</para>
    <substeps>
     <step>
      <para>Set <guimenu>IP Protocol</guimenu> to <literal>TCP</literal>.</para>
     </step>
     <step>
      <para>Enter the value <literal>22</literal> in both
      <guimenu>From Port</guimenu> and <guimenu>To Port</guimenu>. The port fields
      specify a range of ports. In this case, only port <literal>22</literal>
      is opened.</para>
     </step>
     <step>
      <para>To allow access from <emphasis>all</emphasis> IP addresses (specified 
      in CIDR notation as <literal>0.0.0.0/0</literal>), leave the other fields 
      unchanged.
      </para>
      <para>Alternatively, you can limit the SSH access to the specified port to
      access from other security groups only. In that case, select the desired 
      security group from the <guimenu>CIDR</guimenu> drop-down list. </para>
     </step>
     <step>
      <para>Confirm your changes to add the rule.</para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     <remark>taroth 2012-08-15: DEVs, is the following correct?</remark>
    To allow pinging the instances:</para>
    <substeps>
     <step>
      <para>Set <guimenu>IP Protocol</guimenu> to <literal>ICMP</literal>.
      </para>
     </step>
     <step>
      <para>Enter the value <literal>-1</literal> in both <guimenu>From
        Port</guimenu> and <guimenu>To Port</guimenu>. As ICPM does not use ports,
        with <literal>-1</literal> we allow access to all codes and all types of
        ICMP traffic, respectively.</para>
     </step>
     <step>
      <para>To allow access from <emphasis>all</emphasis> IP addresses 
      (<literal>0.0.0.0/0</literal>), leave the other fields unchanged.
      </para>
      <para>Alternatively, to allow only members of other security groups to ping
      instances, select the desired security group from the <guimenu>CIDR</guimenu>
      drop-down list.</para>
     </step>
     <step>
      <para>Confirm your changes to add the rule.</para>
     </step>
    </substeps>
   </step>
  </procedure>
  <para>
   <remark>taroth 2012-08-15: DEVs, any example for which goal/scenario to use
     the UDP protocol? and how to set the other parameters for a UDP example? 
    </remark>
  </para>
   <!--taroth 2012-08-15: mention when non-default sec groups are useful (info
   by mvidner, for CLI chapter mention how to change security groups for running 
   instances, info by cthiel: 
   sure, this is possible, but AFAIK only through the command-line:

   usage: nova add-secgroup <server> <secgroup>
   Add a Security Group to a server.

   Positional arguments:
   <server>    Name or ID of server.
   <secgroup>  Name of Security Group.


   usage: nova remove-secgroup <server> <secgroup>

   Remove a Security Group from a server.

   Positional arguments:
   <server>    Name or ID of server.
   <secgroup>  Name of Security Group.
  -->
 </sect1>
 <sect1 id="sec.user.instances.vol">
  <title>Managing Volumes</title>
  <para></para>
 </sect1>
</chapter>
