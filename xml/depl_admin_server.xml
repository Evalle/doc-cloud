<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet
 href="urn:x-daps:xslt:profiling:novdoc-profile.xsl" 
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "IGNORE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<chapter id="cha.depl.admin_server">
 <title>Setting Up the &cloud; &admserv;</title>
 <abstract>
  <para>
   In this chapter you will learn how to install and set up the &admserv; from
   bare metal. As a result, the &admserv; will be ready to deploy ostack;
   nodes and services. It will run on &sls; 11 SP2 plus add-on products &smtool;
   (also referred to as &smt;, optional) and &cloud;.
  </para>
 </abstract>
 
 <sect1 id="sec.depl.admin_server.requirements">
  <title>Requirements</title>
  <para>
   In order to set up the &admserv; the following requirements need to be met
   prior to installing the server: 
  </para>
  <variablelist>
   <title>Requirements for &admserv;</title>
   <varlistentry>
    <term>Hardware</term>
    <listitem>
     <para>
      The &admserv; does not need to be a physical machine, you can also
      use a virtual machine. However, using a physical machine is recommended.
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Architecture: x86_64
       </para>
      </listitem>
      <listitem>
       <para>
        <remark condition="clarity">
         2012-08-01 - fs: Recommendation OK?
        </remark>
        RAM: at least 2 GB, 4 GB recommended
       </para>
      </listitem>
      <listitem>
       <para>
        Harddisk: at least 40 GB
       </para>
      </listitem>
      <listitem>
       <para>
        <remark condition="clarity">
         2012-08-01 - fs: Please review
        </remark>
        Number of network cards: 2
       </para>
       <important>
        <title>Teaming support</title>
        <para>
         <remark condition="clarity">
         2012-08-01 - fs: Is this correct?
        </remark>
         The network card used as <systemitem
         class="resource">eth0</systemitem> needs to support <literal>NIC
         Teaming</literal>. If you are deploying the &admserv; on a virtual
         machine, be aware that fully virtualized NICs may not support teaming.
        </para>
       </important>
      </listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Network</term>
    <listitem>
     <para>
      The network configuration on the nodes in the &cloud; network is
      entirely controlled by &crow;. Any network configuration not done with
      &crow; (e.g. with &yast;) will automatically be overwritten. Once the
      cloud is deployed, network settings cannot be changed anymore! 
      By default the following networks will be created within the &cloud;:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        <systemitem class="etheraddress">192.168.124/24</systemitem> (admin
        network to access the &admserv; and the &ostack; nodes)
       </para>
      </listitem>
      <listitem>
       <para>
        <systemitem class="etheraddress">192.168.122/24</systemitem> (vLAN,
        public network to access the &dash; and the &vmguest;s)
       </para>
      </listitem>
      <listitem>
       <para>
        <systemitem class="etheraddress">192.168.123/24</systemitem> (vLAN,
        network for inter-&vmguest; communication, internal only)
       </para>
      </listitem>
      <listitem>
       <para>
        <systemitem class="etheraddress">192.168.125/24</systemitem> (vLAN,
        network for &store; (Swift), internal only)
       </para>
      </listitem>
     </itemizedlist>
     <para>
      If these default IP ranges do not met your requirements and/or if you
      follow the network proposal described at FIXME, you need to adjust the
      network configuration templates <emphasis>prior</emphasis> to running
      the &cloud; setup script. See FIXME for instructions.
     </para>
     <para>
      Any additional network card (<systemitem
      class="resource">eth1</systemitem>+) on the &admserv; that is used to
      access other networks, must have a static IP address&mdash;DHCP is
      currently not supported. These interfaces will be shut down up by &crow;
      during the &cloud; setup process and will only be set up
      <emphasis>after</emphasis> the &admserv; installation has been
      finished. As a consequence, external repositories (if configured at the
      time you run the &cloud; installation script) need to be accessible from
      the first network card (<systemitem class="resource">eth0</systemitem>).
     </para>
     <para>
      If you install the &smt; Add-On product you need to be able to access
      the internet from one of the network interfaces on the &admserv;.
     </para>
     <important>
      <title>Network Requirements Summary</title>
      <itemizedlist>
       <listitem>
        <para>
         Network setup is completely controlled by &crow;
        </para>
       </listitem>
       <listitem>
        <para>
         Network setup cannot be changed once &cloud; is deployed
        </para>
       </listitem>
       <listitem>
        <para>
         NIC used for <systemitem class="resource">eth0</systemitem> needs to
         support teaming
        </para>
       </listitem>
       <listitem>
        <para>
         external repositories need to be accessible via <systemitem
         class="resource">eth0</systemitem>
        </para>
       </listitem>
       <listitem>
        <para>
         additional network interfaces <systemitem
         class="resource">eth1</systemitem>+ need to be have a static IP address
        </para>
       </listitem>
       <listitem>
        <para>
         If the &smt; server is installed, internet access is required
        </para>
       </listitem>
      </itemizedlist>
     </important>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Software</term>
    <listitem>
     <itemizedlist>
      <listitem>
       <para>
        &sls; 11 SP2 installation media (included in the &cloud; &admserv;
        subscription)   
       </para>
      </listitem>
      <listitem>
       <para>
        Access to the &sls; 11 SP2 Update repositories (either by registering
        &sls; 11 SP2 or via an existing &smt; server)
       </para>
      </listitem>
      <listitem>
       <para>
        &smt; installation media (optional, not needed if you have access to
        an existing &smt; server); free download available on <ulink
        url="http://www.novell.com/linux/smt/"/>.
       </para>
      </listitem>
      <listitem>
       <para>
        &cloud; installation media
       </para>
      </listitem>
      <listitem>
       <para>
        A &suse;/&novell; account (for product registration and &smt; setup). If
        you do not already have one, go to <ulink
        url="http://www.suse.com/login"/> to create it. 
       </para>
      </listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 
 <sect1 id="sec.depl.admin_server.install">
  <title>Installation</title>
  <para>
   Installing the &admserv; involves the following steps:
  </para>
  <orderedlist>
   <listitem>
    <para>
     <!-- Operating System Installation -->
     <xref linkend="sec.depl.admin_server.install.os" xrefstyle="select:title nopage"/>
    </para>
    <orderedlist>
     <listitem>
      <para>
       <!-- Add-On Products Selection -->
       <xref linkend="sec.depl.admin_server.install.os.add_on" xrefstyle="select:title nopage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <!-- Partitioning -->
       <xref linkend="sec.depl.admin_server.install.os.partition" xrefstyle="select:title nopage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <!-- Software Selection -->
       <xref linkend="sec.depl.admin_server.install.os.software" xrefstyle="select:title nopage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <!-- Product registration -->
       <xref linkend="sec.depl.admin_server.install.os.software" xrefstyle="select:title nopage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <!-- CA configuration -->
       <xref linkend="sec.depl.admin_server.install.os.ca" xrefstyle="select:title nopage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <!-- Basic network configuration -->
       <xref linkend="sec.depl.admin_server.install.os.network" xrefstyle="select:title nopage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <!-- SMT Configuration -->
       <xref linkend="sec.depl.admin_server.install.os.smt" xrefstyle="select:title nopage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <!-- Crowbar configuration -->
       <xref linkend="sec.depl.admin_server.install.os.crowbar" xrefstyle="select:title nopage"/>
      </para>
     </listitem>
    </orderedlist>
   </listitem>
   <listitem>
    <para>
     &smt; repository setup
    </para>
   </listitem>
   <listitem>
    <para>
     &admserv; repository setup
    </para>
   </listitem>
   <listitem>
    <para>
     Deploy the &cloud; &admserv;
    </para>
   </listitem>
  </orderedlist>
  <sect2 id="sec.depl.admin_server.install.os">
   <title>Operating System Installation</title>
   <para>
    Starting with a bare metal server, the first thing you need to do when
    deploying &cloud; is to install &sls; on the machine that should serve as
    the &admserv;. 
   </para>
   <para>
    Start the installation by booting from the &sls; 11 SP2 installation
    medium. For an installation overview refer to the &sls; &instquick;;
    detailed installation instructions are available in the &sls;
    <citetitle>Deployment Guide</citetitle>. Both documents are available at
    <ulink url="http://www.suse.com/documentation/sles11/"/>. The following
    will only cover issues that differ from the default installation process.
   </para>
   <para>
    Installing the Add-On products &cloud; and &smt; during the &sls;
    installation is recommended. Make sure to be able to access the
    installation media (DVD or iso image). Alternatively you may do the Add-On
    product installation after the &sls; installation.
   </para>
   <para>
    If you have access to an &smt; server within your organization, it is
    recommended using it for &cloud;, too. In this case skip the &smt; Add-On
    product installation. If you have no access to an &smt; server, installing
    it is required.
   </para>
   <sect3 id="sec.depl.admin_server.install.os.add_on">
    <title>Add-On Product Selection</title>
    <para>
     Click <guimenu>Include Add-On products from Separate Media</guimenu> on
     the <guimenu>Installation Mode</guimenu> screen. The Add-On product
     installation dialog will show up after proceeding with
     <guimenu>Next</guimenu>. Skip the network installation dialog if you have
     direct access to the installation media (e.g. via DVD or USB stick).
     Add the &cloud; and &smt; products and proceed with the
     installation. Consult the &sls; Deployment Guide at <ulink
     url="http://www.suse.com/documentation/sles11/book_sle_deployment/data/sec_i_yast2_inst_mode.html"/>
     for detailed instructions.
    </para>
   </sect3>
   <sect3 id="sec.depl.admin_server.install.os.partition">
    <title>Partitioning</title>
    <para>
     &cloud; has no special requirements in regards of partitioning. However,
     it is recommended to create a separate partition or volume for
     <filename>/srv</filename>. This partition will host all update
     repositories mirrored by &smt; as well as the complete data from the
     &sls; and &cloud; installation media for the node deployment. A size of
     at least 25 GB is required. Help on using the partitioning tool is
     available at <ulink
     url="http://www.suse.com/documentation/sles11/book_sle_deployment/data/sec_yast2_i_y2_part_expert.html"/>.
    </para>
   </sect3>

   <sect3 id="sec.depl.admin_server.install.os.software">
    <title>Software selection</title>
    <para>
     Installing a fairly minimal base system is sufficient to set up the
     &admserv;. The following patterns are the minimum requirement:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       <guimenu>Base System</guimenu>
      </para>
     </listitem>
     <listitem>
      <para>
       <guimenu>Minimal System (Appliances)</guimenu>
      </para>
     </listitem>
     <listitem>
      <para>
       <guimenu>Subscription Management Tool</guimenu> (SMT)
      </para>
     </listitem>
     <listitem>
      <para>
       <guimenu>SUSE Cloud Admin Node</guimenu>
      </para>
     </listitem>
     <listitem>
      <para>
       <guimenu>Web and LAMP Sever</guimenu>
      </para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 id="sec.depl.admin_server.install.os.registration">
    <title>Product Registration</title>
    <para>
     If you have installed the &smt; Add-On product, you must register your
     &sls; version at the &ncc; now, otherwise you will not be able to
     configure the &smt; server. You have received a &sls; registration key
     with the &cloud; &admserv; subscription. See <ulink
     url="http://www.suse.com/documentation/sles11/book_sle_deployment/data/sec_i_yast2_conf.html"/>
     for details on the &ncc; registration.
    </para>
   </sect3>
   
   <sect3 id="sec.depl.admin_server.install.os.ca">
    <title>CA Setup</title>
    <para>
     <remark condition="clarity">
      2012-08-02 - fs: How to use an external CA?
     </remark>
     &ostack; needs access to a certification authority (CA) for project
     VPNs and encrypted images. If you can access an existing CA within your
     organization, you can use it as described in FIXME. If not, you need to
     set up a CA on the &admserv;. See <ulink
     url="http://www.suse.com/documentation/sles11/book_security/data/cha_security_yast_ca.html"/>
     for more information.
    </para>
   </sect3>
   
   <sect3 id="sec.depl.admin_server.install.os.network">
    <title>Basic Network Configuration</title>
    <para>
     
     <remark condition="clarity">
      2012-08-02 - fs: Which firewall settings should be applied to the
      interfaces?
     </remark>
     
     All network interfaces on the &admserv; need to be configured during the
     installation. Since &crow; does not support DHCP, you need to assign
     static IP addresses for each interface. The default setup supports one
     network interface (<systemitem class="resource">eth0</systemitem> ) with
     the IP address <systemitem
     class="etheraddress">192.168.124.10/24</systemitem>. Using a custom IP
     address or more than one network interfaces requires to adjust the
     crowbar configuration as described in FIXME.
    </para>
    <para>
     If you realize the &cloud; network example, addresses need to be
     assigned as follows: FIXME 
    </para>
   </sect3>
   
   <sect3 id="sec.depl.admin_server.install.os.smt">
    <title>&smt; Configuration</title>
    <para>
     
     <remark condition="clarity">
      2012-08-02 - fs: Open port in firewall?
     </remark>
     
     Configuring the &smt; server requires you to have your mirroring
     credentials and your registration e-mail address at hand. Log in to the
     &ncc; at <ulink url="http://www.novell.com/center/"/>. Get the mirror
     credentials by going to <menuchoice> <guimenu>My Products</guimenu>
     <guimenu>Mirror Credentials</guimenu> </menuchoice> in the left
     navigation. Your registration e-mail address can be obtained from
     <menuchoice> <guimenu>My Profile</guimenu> <guimenu>Login
     Profile</guimenu> </menuchoice>. Enter this data at the <guimenu>SMT
     Configuration Wizard Step 1/2</guimenu> screen at the fields
     <guimenu>User</guimenu>, <guimenu>Password</guimenu>, and <guimenu>NCC
     E-mail Used for Registration</guimenu> and accept the pre-filled defaults
     for the other input fields.  
    </para>
    <para>
     In step two of the &smt; configuration you need to enter database
     passwords and specify an e-mail address for getting reports. Refer to
     <ulink url="http://www.suse.com/documentation/smt11/"/> for the complete
     <citetitle>SMT for SUSE Linux Enterprise 11 Guide</citetitle>.
    </para>
   </sect3>
   
   <sect3 id="sec.depl.admin_server.install.os.crowbar">
    <title>&crow; Setup</title>
    <para>
     FIXME - to be described once we have the network proposal 
    </para>
   </sect3>
  </sect2>
  
  <sect2 id="sec.depl.admin_server.install.smt_repos">
   <title>Setting up the &smt; Repositories</title>
   <para>
    
   </para>
  </sect2>

  <sect2 id="sec.depl.admin_server.install.local_repos">
   <title>Setting Up Local Repositories</title>
   <para>
    
   </para>
  </sect2>

  <sect2 id="sec.depl.admin_server.install.cloud_setup">
   <title>Setting up &cloud;</title>
   <para>
    
   </para>
  </sect2>
  
 </sect1>
 

 
<!-- Add-On Products:
  - SMT
  - Cloud

Software selection:
  Install proposal -> Software -> SUSE Cloud Admin Node

Recommended Partitioning:
  - srv on own partition with minimum of 30GB

Register Product !!!

Fixed IP Address: 192.168.124.10/24   -> Routing/DNS ?
No network manager
Firewall settings???

Online update! -> may skip and do it later if SMT

Set up CA!

Network User Authentication??


SMT Setup:
  Reg Server Url, Download Server Url
    -> do not change unless??
  www.novell.com/center/ -> My Products -> Mirror Credentials
  User: 
  Password:

  after data is entered SMT runs a synchronization check -> takes up to a few minutes


Crowbar configuration:
  password for crowbar admin (User crowbar):
    default: crowbar/crowbar

Release Notes: Tabs for SLES, SMT, Cloud



Installation finished:
- smt repo commands, smt mirror
- symlink channels
- copy SLES and Cloud repos
- disable remote repos:
  zypper ms -d -R nu_novell_com
  zypper mr -d -R $(zypper lr -s | grep "nu_novell_com" | cut -c 1-3)
- add local repos
  for REP in 1-Update 1-Pool 2-Update 2-Core; do
    zypper ar /srv/www/htdocs/repo/\$RCE/SLES11-SP$REP/sle-11-x86_64 SLES11-SP$REP
  done
- optional: modify repos that have been copied to /srv/tftpboot (SLES, Cloud)
  -delete and add it again (only way):
   zypper rr <repo>
   zypper ar /srv/tftpboot/suse-11.2/install "SLES11-SP2"
   zypper ar /srv/tftpboot/repos/Cloud "SUSE Cloud"



Questions:
* How to use external DNS?
* How to use external SMT?
* How to use external CA?

* Automatic network setup vs.
  https://github.com/dellcloudedge/crowbar/wiki/Crowbar-Openstack-Networking-Visio
   -> routing.

* SMT repos for SMT/Cloud?
* Delivery of updates to nodes (incl. admin) and VM instances?
  - Delivery of updates for other OS than SUSE?

-->
</chapter>
