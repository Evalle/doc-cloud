<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet
 href="urn:x-daps:xslt:profiling:novdoc-profile.xsl" 
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "IGNORE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<chapter id="cha.depl.admin_server">
 <title>Setting Up the &cloud; &admserv;</title>
 <abstract>
  <para>
   In this chapter you will learn how to install and set up the &admserv; from
   bare metal. As a result, the &admserv; will be ready to deploy &ostack;
   nodes and services. It will run on &sls; 11 SP2 and will include the add-on 
   products &productname; and &smt; (optional).
  </para>
 </abstract>

 <sect1 id="sec.depl.admin_server.install">
  <title>Installation</title>
  <para>
   Installing the &admserv; involves the following basic steps:
  </para>
  <orderedlist>
   <listitem>
    <para>
     <!-- Operating System Installation -->
     <xref linkend="sec.depl.admin_server.install.os" xrefstyle="select:title nopage"/>
    </para>
    <orderedlist>
     <listitem>
      <para>
       <!-- Add-On Products Selection -->
       <xref linkend="sec.depl.admin_server.install.os.add_on" xrefstyle="select:title nopage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <!-- Partitioning -->
       <xref linkend="sec.depl.admin_server.install.os.partition" xrefstyle="select:title nopage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <!-- Software Selection -->
       <xref linkend="sec.depl.admin_server.install.os.software" xrefstyle="select:title nopage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <!-- Product registration -->
       <xref linkend="sec.depl.admin_server.install.os.software" xrefstyle="select:title nopage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <!-- CA configuration -->
       <xref linkend="sec.depl.admin_server.install.os.ca" xrefstyle="select:title nopage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <!-- Basic network configuration -->
       <xref linkend="sec.depl.admin_server.install.os.network" xrefstyle="select:title nopage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <!-- SMT Configuration -->
       <xref linkend="sec.depl.admin_server.install.os.smt" xrefstyle="select:title nopage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <!-- Crowbar configuration -->
       <xref linkend="sec.depl.admin_server.install.os.crowbar" xrefstyle="select:title nopage"/>
      </para>
     </listitem>
    </orderedlist>
   </listitem>
   <listitem>
    <para>
     <!-- SMT repository setup -->
     <xref linkend="sec.depl.admin_server.install.smt_repos" xrefstyle="select:title nopage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <!-- Local repository setup -->
     <xref linkend="sec.depl.admin_server.install.local_repos" xrefstyle="select:title nopage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <!-- Run install -chef-suse.sh -->
     <xref linkend="sec.depl.admin_server.install.cloud_setup" xrefstyle="select:title nopage"/>
    </para>
   </listitem>
  </orderedlist>
  <sect2 id="sec.depl.admin_server.install.os">
   <title>Operating System Installation</title>
   <para>
    Starting with a bare metal server, install &sls; on the machine that should 
    serve as the &admserv;. 
   </para>
   <para>
    Start the installation by booting from the &sls; 11 SP2 installation
    medium. </para>
    <note><title>Differences from the Default Installation Process</title>
    <para>For an overview of a default &sls; installation, refer to the &sls; 
    &instquick;. Detailed installation instructions are available in the &sls;
    <citetitle>Deployment Guide</citetitle>. Both documents are available at
    <ulink url="http://www.suse.com/documentation/sles11/"/>.</para>
    <para>The following sections will only cover the differences from the 
    default installation process.
    </para>
   </note>
   <para>
    Installing the Add-On products &cloud; and &smt; during the &sls;
    installation is recommended. Make sure to be able to access the
    installation media (DVD or iso image). Alternatively, install the 
    add-on products after the &sls; installation.
   </para>
   <para>
    If you have access to an &smt; server within your organization, it is
    recommended using it for &cloud;, too. In this case skip the &smt; Add-On
    product installation. If you have no access to an &smt; server, installing
    it is required.
   </para>
   <sect3 id="sec.depl.admin_server.install.os.add_on">
    <title>Add-On Product Selection</title>
    <para>
     On the <guimenu>Installation Mode</guimenu> screen, click <guimenu>Include 
     Add-On products from Separate Media</guimenu>. Proceed with 
     <guimenu>Next</guimenu> to the Add-On product installation dialog. 
     I you have direct access to the installation media (for example, via DVD or 
     USB stick), skip the network installation dialog. Otherwise configure the 
     network as described in <xref linkend="sec.depl.admin_server.install.os.network"/>.  
     Add &cloud; and &smt; (optional) as add-on products and proceed with the
     installation. Consult the &sls; <citetitle>Deployment Guide</citetitle>
     at <ulink url="http://www.suse.com/documentation/sles11/book_sle_deployment/data/sec_i_yast2_inst_mode.html"/>
     for detailed instructions.
    </para>
   </sect3>
   <sect3 id="sec.depl.admin_server.install.os.partition">
    <title>Partitioning</title>
    <para>Currently, &crow; requires <filename>/opt</filename> to be writable.
     Apart from that, &cloud; has no special requirements in regards of partitioning. However,
     it is recommended to create a separate partition or volume for
     <filename>/srv</filename>. This partition will host all update
     repositories mirrored by &smt; as well as the complete data from the
     &sls; and &cloud; installation media for the node deployment. A size of
     at least 25 GB is required. Help on using the partitioning tool is
     available at <ulink url="http://www.suse.com/documentation/sles11/book_sle_deployment/data/sec_yast2_i_y2_part_expert.html"/>.
    </para>
   </sect3>

   <sect3 id="sec.depl.admin_server.install.os.software">
    <title>Software selection</title>
    <para>
     Installing a minimal base system is sufficient to set up the
     &admserv;. The following patterns are the minimum requirement:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       <guimenu>Base System</guimenu>
      </para>
     </listitem>
     <listitem>
      <para>
       <guimenu>Minimal System (Appliances)</guimenu>
      </para>
     </listitem>
     <listitem>
      <para>
       <guimenu>Subscription Management Tool</guimenu> (optional)
      </para>
     </listitem>
     <listitem>
      <para>
       <guimenu>SUSE Cloud Admin Node</guimenu>
      </para>
     </listitem>
     <listitem>
      <para>
       <guimenu>Web and LAMP Server</guimenu> (only needed when installing 
       &smt; on the &admserv;)
       
      </para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 id="sec.depl.admin_server.install.os.registration">
    <title>Product Registration</title>
    <para>
     If you have installed the &smt; Add-On product, you must register your
     &sls; version at the &ncc; now, otherwise you will not be able to
     configure the &smt; server. You have received a &sls; registration key
     with the &cloud; &admserv; subscription. See <ulink url="http://www.suse.com/documentation/sles11/book_sle_deployment/data/sec_i_yast2_conf.html"/>
     for details on the &ncc; registration.
    </para>
   </sect3>

   <sect3 id="sec.depl.admin_server.install.os.ca">
    <title>CA Setup</title>
    <para>
     &ostack; needs access to a certification authority (CA) for project VPNs
     and encrypted images, &smt; needs it to validate server certificates. If
     you already have a CA certificate in your organization, import it. 
     Otherwise generate all certificates in the &admserv; itself by accepting
     the &yast; proposal. See <ulink url="http://www.suse.com/documentation/sles11/book_security/data/cha_security_yast_ca.html"/>
     for more information.
    </para>
   </sect3>

   <sect3 id="sec.depl.admin_server.install.os.network">
    <title>Basic Network Configuration</title>
    <para>

<!--Note that if you configure /etc/resolv.conf on the &admserv; to point to
upstream DNS nameservers, then the bind DNS software which automatically gets
set up during the installation process will automatically be configured to
forward requests for non-local records to those servers.-->
    
     All network interfaces on the &admserv; need to be configured during the
     installation. Since &crow; does not support DHCP, you need to assign
     static IP addresses for each interface. The default setup supports one
     network interface (<systemitem class="resource">eth0</systemitem> ) with
     the IP address <systemitem class="etheraddress">192.168.124.10/24</systemitem>. Using a custom IP
     address or more than one network interfaces requires to adjust the
     &crow; configuration in a later step as described in <xref linkend="sec.depl.admin_server.install.os.crowbar"/>. 
    </para>
    <para>
     You also need to assign a hostname and a full qualified domain name
     (FQDN) such as <replaceable>admin.cloud.&exampledomain;</replaceable> to
     <systemitem class="resource">eth0</systemitem>.
    </para>
    <para>
     Furthermore, the firewall need to be disabled for all interfaces.
    </para>
    <!--
    <para>
     For the <xref linkend="app.deploy.network"/> the following values need to
     be entered:
    </para>
    
    <remark condition="clarity">
     2012-08-09 - fs: Is the DNS and Routing setup correct?
    </remark>
    
    <simplelist>
     <member><guimenu>IP Address</guimenu>: <literal>10.11.20.10</literal></member>
     <member><guimenu>Subnet Mask</guimenu>: <literal>/24</literal></member>
     <member><guimenu>Hostname</guimenu>: <literal>admin.cloud.&exampledomain;</literal></member>
     <member><guimenu>Name Server 1</guimenu>: <literal>10.11.20.10</literal></member>
     <member><guimenu>Name Server 2</guimenu>: <literal>10.10.0.10</literal></member>
     <member><guimenu>Domain Search</guimenu>: <literal>cloud.&exampledomain; &exampledomain;</literal></member>
     <member><guimenu>Default Gateway</guimenu>: <literal>10.11.20.1</literal></member>
    </simplelist>
-->

    <important>
     <title>&admserv; Domain Name and Hostname</title>
     <para>
      Setting up the &cloud; will also install a DNS server for all nodes in
      the cloud. The Domainname you specify for the &admserv; will be used for
      the DNS zone. It is recommended to use a sub-domain such as
      <replaceable>cloud.&exampledomain;</replaceable>.
     </para>
     <para>
      The hostname and the FQDN need to be resolvable with <command>hostname
      <option>-f</option>
      </command>. Double-check whether
      <filename>/etc/hosts</filename> contains an appropriate entry for the
      &admserv;. It should look like the following: 
     </para>
     <screen>191.168.124.10 admin.cloud.&exampledomain; admin</screen>
     <para>
      It is <emphasis>not</emphasis> possible to change the &admserv; hostname
      or the FQDN once the cloud installation script has been run for the
      first time.
     </para>
    </important>

   </sect3>

   <sect3 id="sec.depl.admin_server.install.os.smt">
    <title>&smt; Configuration (optional)</title>
    <para>
     Configuring the &smt; server requires you to have your mirroring
     credentials and your registration e-mail address at hand. To access them,
     log in to the
     &ncc; at <ulink url="http://www.novell.com/center/"/>. Get the mirror
     credentials by selecting <menuchoice> <guimenu>My Products</guimenu>
      <guimenu>Mirror Credentials</guimenu>
     </menuchoice> in the left
     navigation. Obtain your registration e-mail address from
     <menuchoice> <guimenu>My Profile</guimenu>
      <guimenu>Login
     Profile</guimenu>
     </menuchoice>.</para>
     <para>Enter this data at the <guimenu>SMT
     Configuration Wizard Step 1/2</guimenu> into the fields
     <guimenu>User</guimenu>, <guimenu>Password</guimenu>, and <guimenu>NCC
     E-mail Used for Registration</guimenu>. Accept the pre-filled defaults
     for the other input fields.  Make sure to <guimenu>Test</guimenu> the
     credentials. 
    </para>
    <para>
     In step two of the &smt; configuration you need to enter database
     passwords and specify an e-mail address for getting reports. Refer to
     <ulink url="http://www.suse.com/documentation/smt11/"/> for the complete
     <citetitle>SMT for SUSE Linux Enterprise 11 Guide</citetitle>.
    </para>
   </sect3>

   <sect3 id="sec.depl.admin_server.install.os.crowbar">
    <title>&crow; Setup</title>
    <para>
     This &yast; module allows you to change the user and password for
     the &crow; Web interface that lets you deploy the &ostack;
     nodes. Furthermore it allows you to basically configure all networks
     within the cloud.
    </para>

    <warning>
     <title>No Network Configuration Changes at a Later Stage</title>
     <para>
      Currently, it is <emphasis>not</emphasis> possible to change
      <emphasis>any</emphasis> aspects of the network configuration (including
      the IP ranges) once &cloud; has been set up. 
      <!-- Planned for 2.0 -->
     </para>
    </warning>
    
<!--
    Magic:
      Another dumb question: Why do I need a physical and a virtual BMC LAN
      and why do both have the same address?
    rhafer:
      The bmc_vlan think is only relevant on the &admserv;. It will only get
      used if the bmc network is on a differnent network than the admin
      network. to cite the code:
      "   # Add the vlan bmc if the bmc network and the admin network are not
          #  the same.
          # not great to do it this way, but hey."
    Magic:
      So if the admin host has no BMC than the two bmc networks are obsolete,
      right?
    rhafer:
      Yes. But it might be that the "host" range defined  in the bmc
      network is inside the "admin" network in such a case. Otherwise the
      network barclamp might start acting up. (I never tried that)
    rhafer:
      The "bmc" range is really special as it doesn't map to a ifcfg-
      configfile on the actual machine but the setting are applied to the bmc
      directly via ipmitool.
-->

<!-- nova-fixed
Magic:
  The router for the nova-fixed network has the default address of
  192.168.123.1. I guess this router is used to communicate with the outside
  world. Within the nova fixed network you also define an IP_range "router". I
  guess these are used to form groups of instances that can communicate with
  each other. Is that correct? 
rhafer:
  Not exactly. The router (192.168.123.1) setting for the "nova-fixed" network
  is by default never used. This is caused by value of "router_pref". The
  "router_pref" is used to compute which ip to set for the default route on a
  specific node. The router with the lowest "router_pref" of the available
  network for a node will be choosen. (Note that different nodes can be
  members of different networks).
Magic:
  So in this case it's best to _not_ change that value
rhafer:
  Unless you really know what you are doing :) (Which I wouldn't claim for
  myself) :)
Magic:
  Which router do the instances in the fixed network use for communication
  with the outside world? 192.168.122.1? 
rhafer:
  By default the router_prefs are set so that members of the "public" network
  use the router defined for that network. So yes, 192.168.122.1 by
  default. All other nodes will use the admin networks default route.
Magic:
  Good to know!
rhafer:
  Only nodes which aren't part of the admin network and the public would use
  the one of the nove_fixed "network" if they are a member of that. (But this
  can't really happen). The purpose "router" range in the nova_fixed network
  is AFAIK that instances running on different nodes are able to talk to each
  other.
-->
<!--
    <screen>
     Definitions:
     admin:
       admin:  fixed IP address of &admserv;
       dhcp:   address range used for nodes not yet allocated
       host:   address range used for the allocated &ostack; nodes
               => by default max. 79 nodes (but 161 - 240 allocated by
                  bmc/bmc_vlan network)
       switch: address range reserved for switches 

     nova-fixed:
       dhcp:   address range for VMs (non-floating)
       router: address range for routers (for inter-VM communication, even
               when VMs are started on different nodes)

     nova-floating:
       floating IPs

     public:
       dhcp: ???
       host: ???

     storage:
       host: ???
       
     admin host:
       Bridge:  No
       VLAN:    No
       Router:  10.11.20.1
       Subnet:  10.11.20.0
       Netmask: 255.255.255.0
       admin:   10.11.20.10  - 10.11.20.11
       dhcp:    10.11.20.21  - 10.11.20.80
       host:    10.11.20.81  - 10.11.20.160
       switch:  10.11.20.241 - 10.11.20.250

       => Important: .161 - .240 allocated by bmc/bmc_vlan
       
     bmc:
       Bridge: No
       VLAN:   No
       Router: -
       Netmask: 255.255.255.0
       Subnet: 10.11.20.0
       host:   10.11.20.162 - 10.11.20.240

     bmc_vlan:
       Bridge:  No
       VLAN:    Yes
       VLAN-ID: 100 
       Netmask: 255.255.255.0
       Router:  -
       Subnet:  10.11.20.0
       host:    10.11.20.161 - 10.11.20.161

     nova-fixed:
       Bridge:  Yes
       VLAN:    Yes
       VLAN-ID: 500
       Netmask: 255.255.255.0
       Router:  10.11.21.1
       Subnet:  10.11.21.0
       dhcp:    10.11.21.50 - 10.11.21.254
       router:  10.11.21.1  - 10.11.21.49

     nova-floating:
       Bridge:  No
       VLAN:    Yes
       VLAN-ID: 300 (needs to be the same as public)
       Netmask: 255.255.255.192
       Router:  -
       Subnet:  10.11.22.128
       host:    10.11.22.129 - 10.11.22.191    

     public:
       Bridge:  No
       VLAN:    Yes
       VLAN-ID: 300 (same as nova-floating)
       Netmask: 255.255.255.0
       Router:  10.11.22.1
       Subnet:  10.11.22.0
       dhcp:    10.11.22.50 - 10.11.22.127  => purpose??
       host:    10.11.22.2  - 10.11.22.49   => purpose??

     storage:
       Bridge:  No
       VLAN:    Yes
       VLAN-ID: 200
       Netmask: 255.255.255.0
       Router:  -
       Subnet:  10.11.23.0
       host:    10.11.23.10  - 10.11.23.239   => purpose??
       
        ==> 10.11.23.2 - 10.11.23.9 can be used for e.g. SANs ??
    </screen>
    -->
   </sect3>
  </sect2>

  <sect2 id="sec.depl.admin_server.install.smt_repos">
   <title>Setting up the &smt; Repositories (optional)</title>
   <para>
    <remark condition="clarity">
     2012-08-02 - fs: What about mirroring Cloud and SMT update repositories?
    </remark>
    During the installation the &smt; server was set up to be able to
    communicate with the &ncc;. In this step we will add and mirror the update
    repositories for &sls; and for &productname;. They will serve as the update 
    source for the &ostack; nodes. Run the following commands as user &rootuser;: 
   </para>

   <screen><?dbsuse-fo font-size="0.63em"?>for REPO in SLES11-SP{2-Core,2-Updates,1-Pool} SUSE-Cloud-1.0-{Pool,Updates}; do
smt repos $REPO sle-11-x86_64 -e
done
smt mirror -L /var/log/smt/smt-mirror.log</screen>
   
<!--taroth 2012-08-27: commented as Cloud update repos have been added, therefore
had to adjust the for loop accordingly-->
<!--
<screen>for REPO in 1-Pool 1-Update 2-Core 2-Update; do
>  smt repos SLES11-SP$REPO sle-11-x86_64 -e
> done
smt mirror -L /var/log/smt/smt-mirror.log</screen>-->
   <para>
    The <command>smt mirror</command> command will download approximately 
    14&nbsp;GB of patches. This process may last up to several hours. A log file 
    is written to <filename>/var/log/smt/smt-mirror.log</filename>.
   </para>
  </sect2>

  <sect2 id="sec.depl.admin_server.install.local_repos">
   <title>Setting Up Local Repositories</title>
   <para>

    <remark condition="clarity">
     2012-08-02 - fs: What about Cloud and SMT update repositories?
    </remark>
    
    In order to deploy the &ostack; nodes and to provide update repositories for
    them, repositories must be locally available at
    <filename>/srv/tftpboot</filename>. 
   </para>
   <procedure>
    <step>
     <para>
      Make the  contents of the &sls; installation medium available at
      <filename>/srv/tftpboot/suse-11.2/install/</filename>. Either mount the
      medium or copy its contents. Do not link it, as this may cause trouble
      when PXE-booting clients.<remark>aspiers 2012-08-17: 
      let's be clear about this one way or the other.  Why
      might it cause trouble?  Does the tftpd run chroot or something? 
      - taroth 2012-08-17: no idea, DEVs - any ideas from your side?</remark>
     </para>
     <para>
      If copying, it is recommended to use <command>rsync</command>. If the
      installation data is located on a removable device, make sure to mount
      it first (for example, after inserting the DVD in the &admserv; and waiting 
      for the device to become ready):
     </para>
     <screen>mount /dev/dvd /mnt
rsync -avP /mnt/ /srv/tftpboot/suse-11.2/install/
umount /mnt</screen>
     <note>
      <title>Mind the Trailing Slash</title>
      <para>
       The <command>rsync</command> command must be used with a trailing slash 
       in <filename>/mnt/</filename> as shown above. Otherwise rsync would only
       copy the <filename>/mnt</filename> directory itself, but not its contents.
      </para>
     </note>
     <para>
      If the installation data is provided by a remote machine, log in to that
      machine and push the data to the &admserv; (which has the IP address
      <systemitem class="etheraddress">192.168.124.10</systemitem> in the
      following example):
     </para>
     <screen>rsync -avPz <replaceable>/data/sles11sp2/</replaceable> <replaceable>192.168.124.10</replaceable>:/srv/tftpboot/suse-11.2/install/</screen>
    </step>
    <step>
     <para>
      Make the contents of the &cloud; installation medium available at
      <filename>/srv/tftpboot/repos/Cloud/</filename> using one of the
      techniques described in the previous step.
     </para>
    </step>
    <step>
     <para>
      It is recommended to use the two directories created in the previous
      steps as the installation source for &sls; and &cloud;. In order to do
      so, remove the existing two repositories and add them again with the new
      location (the local directories at <filename>/srv/tftpboot/</filename>).
     </para>
    </step>
    <step>
     <para>
      Link the &smt; update repositories (in this case links can be used,
      because these repositories are not used for PXE-booting). Since they are
      available locally there is no need to use remote repositories for
      updating &admserv; itself, therefore add these repositories to
      <systemitem class="library">libzypp</systemitem>, too:
     </para>
     <screen><?dbsuse-fo font-size="0.63em"?>for REPO in SLES11-SP{2-Core,2-Updates,1-Pool} SUSE-Cloud-1.0-{Pool,Updates}; do
ln -s /srv/www/htdocs/repo/\$RCE/$REPO/sle-11-x86_64 /srv/tftpboot/repos/$REPO
zypper ar /srv/www/htdocs/repo/\$RCE/$REPO/sle-11-x86_64 $REPO
done</screen>

<!--taroth 2012-08-27: commented as Cloud update repos have been added, therefore
had to adjust the for loop accordingly-->
<!--     <screen>for REPO in 1-Pool 1-Update 2-Core 2-Update; do
> ln -s /srv/www/htdocs/repo/\$RCE/SLES11-SP$REPO/sle-11-x86_64 \
/srv/tftpboot/repos/SLES11-SP$REPO
> zypper ar /srv/www/htdocs/repo/\$RCE/SLES11-SP$REPO/sle-11-x86_64 \
SLES11-SP$REPO
> done</screen>-->
    </step>
    <step>
     <para>

      <remark condition="clarity">
       2012-08-02 - fs: is it really wise to disable _all_ repos from
       nu_novell_com? There are repositories which have not been mirrored by
       smt...
      </remark>
      
      Now all repositories needed to update all nodes in the cloud (including
      the &admserv;) and to deploy the &ostack; nodes are available as
      local repositories. Therefore remote repositories from the &ncc; can be
      disabled by running the following command:
     </para>
     <screen>zypper ms -d -R nu_novell_com</screen>
     <para>
      Optionally you can also disable automatic refreshing for these repositories:
     </para>
     <screen>zypper mr -d -R `zypper lr -s | grep "nu_novell_com" | cut -c 1-3`</screen>
     <para>The local repository setup is completed. </para>
    </step>
    <step>
     <para>
      If you have skipped the online update during installation, you need to update
      the system now (before starting to set up the cloud):
     </para>
     <screen>zypper patch</screen>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.depl.admin_server.install.cloud_setup">
   <title>Setting up &cloud;</title>
   <para>
    Now everything is in place to finally configure the &admserv;. This is
    done by running the script
    <filename>/opt/dell/bin/install-chef-suse.sh</filename>. This command will 
    install and configure &chef;, and use it to complete the installation of 
    &crow; and all required &barcl;. It will take several minutes to complete.
   </para>

   <warning>
    <title>Double Check Your Hostname</title>
    <para>
     Make absolutely sure your host and domain name are set up correctly and
     are returned when running the command <command>hostname -f</command>. You
     will not be able to change the names after having run
     <filename>install-chef-suse.sh</filename> for the first time. See 
     <xref linkend="sec.depl.admin_server.install.os.network"/> for instructions.
    </para>
   </warning>
<!--
aspiers:
Unfortunately screenlog.0 is generated by the screen process, not by
the script itself, so the script cannot refer to it.  However I think
it's better if the script forks output to somewhere like:

  /var/log/chef/install.log

This is a more appropriate location and is independent of the use of
screen / tmux etc.  Here is the patch which I will try to get into RC1
if it's not too late ;-)

  http://pastebin.suse.de/4757
-->

  <important>
   <title>Losing the Network Connection</title>
   <para>
    Run the installation script <filename>install-chef-suse.sh</filename> 
    inside of a terminal multiplexer like GNU Screen 
    (provided by the <systemitem class="resource"></systemitem> package).
   </para>
   <para>
    During the run of this script the network will be reconfigured. This may 
    result in interrupting the script when being run from a network connection
    (like SSH). Using <command>screen</command> will continue running the script 
    in a session to which you can reconnect via <command>screen -r</command> 
    if you lose the connection.
   </para>
  </important> 
  <!--taroth 2012-08-20: tmux (as an alternative to screen) is not part of the 
  SLE media, therefore did not mention it here-->
 <screen>screen /opt/dell/bin/install-chef-suse.sh</screen>
  <para>
    Note that if you configure <filename>/etc/resolv.conf</filename> on the
    &admserv; to point to upstream DNS nameservers, then the bind DNS
    software which automatically gets set up during the installation process 
    will automatically be configured to forward requests for non-local records 
    to those servers.
   </para>
<!--
   <remark condition="clarity">
    2012-08-14 - fs:

    => if $bastion_network {
          crowbar network -U crowbar -P crowbar allocate_ip default &lt;crowbar.example.com> bastion admin
          chef-client
       }

    => adjust autoyast.xml.erb
    
   </remark>
-->
 </sect2>

</sect1>

</chapter>
