<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE appendix
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<!-- Converted by suse-upgrade version 1.1 -->
<appendix xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="app.deploy.zsystems">
 <title>IBM &zseries; Installation Instructions</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer>fs</dm:maintainer>
   <dm:status>editing</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>no</dm:translation>
   <dm:languages/>
  </dm:docmanager>
 </info>
 <para>
  &cloud; supports the &o_comp; ZVMDriver driver which manages communication
  between &ostack; and a z/VM hypervisor to deploy and manage &vmguest;s
  on z/VM. &productname; does not natively support managing and deploying z/VM
  &vmguest;s&mdash;it delegates requests to an &xcat; server running on
  z/VM. This requires a proper setup on the &zseries; side and a single
  &comp; node on the &cloud; side.
 </para>
 <para>
  IBM supports different ways to set up the &zseries; side. This document
  describes the <literal>CMA mn</literal> setup as described in the <link
  xlink:href="https://www.ibm.com/support/knowledgecenter/en/SSB27U_6.3.0/com.ibm.zvm.v630.hcpo4/cmoover.htm">IBM
  documentation</link>. It configures the z/VM Cloud Manager Appliance (CMA) to
  only run the Extreme Cloud Administration Toolkit (&xcat;) and the ZHCP
  services, because, all &ostack; services are running on external &cloud;
  servers.
 </para>
 <para>
  Additional documentation providing in-depth information to topics also
  covered in this document are available from IBM and can be retrieved from the
  IBM Knowledge Center for z/VM 6.3.0:
 </para>
 <itemizedlist>
  <listitem>
   <para>
    <link xlink:href="https://www.ibm.com/support/knowledgecenter/en/SSB27U_6.3.0/com.ibm.zvm.v630.hcpo4/toc.htm">z/VM Enabling z/VM for OpenStack (Support for OpenStack Liberty Release)</link>
   </para>
  </listitem>
  <listitem>
   <para>
    <link xlink:href="https://www.ibm.com/support/knowledgecenter/en/SSB27U_6.3.0/com.ibm.zvm.v630.dmse6/toc.htm">z/VM: Systems Management Application Programming</link>
   </para>
  </listitem>
 </itemizedlist>
 <para>
  Note, that these manuals contain procedures and setups not tested by
  &suse; or not working with &cloud;. Links to sections covering topics
  described in this manual are provided in the respective sections.
 </para>
 <sect1 xml:id="app.deploy.zsystems.setup">
  <title>Supported Setup</title>
  <para>
   To manage and deploy &vmguest;s on z/VM with &cloud;, a z/VM running the CMA
   with the &xcat; and ZHCP services is required. You also need to set up a
   Linux system running &slsa; 12 SP1 that will be used to capture an image
   from. The setup described in this document uses the following components and
   configurations:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     The &xcat; and the ZHCP servers are running in the CMA, all &ostack;
     services are running on external &cloud; servers. This setup is named
     <literal>CMA mn</literal>.
    </para>
   </listitem>
   <listitem>
    <para>
     Communication between &xcat; and &productname; is done by a single &cloud;
     &comp; node that is deployed and configured from &productname;. This
     &comp; node needs to be an <literal>x86_64</literal> machine.
    </para>
    <para>
     The &xcat; server and the &cloud; &comp; node need to be able to
     bidirectionally communicate with each other. This can, for example, be
     achieved by assigning the &xcat; and the &comp; node IP addresses from the
     public cloud network. See FIXME for details.
    </para>
   </listitem>
   <listitem>
    <para>
     Networking for &zseries; &vmguest;s instances is handled by the &xcat;
     server. See <link
     xlink:href="https://www.ibm.com/support/knowledgecenter/en/SSB27U_6.3.0/com.ibm.zvm.v630.hcpo4/networkcon.htm">Network
     Considerations</link> and the following chapters in the IBM documentation
     for general information. &suse; supports setting up the &xcat; server with
     either a single flat network or a flat and vlan mixed network.
    </para>
   </listitem>
   <listitem>
    <para>
     The Linux image capture system needs to run &slsa; 12 SP1 for IBM
     &zseries; and needs to use ECKD for storage. See <xref
     linkend="sec.deploy.zsystems.image"/> for a full list of requirements for
     this system.
    </para>
   </listitem>
   <listitem>
    <para>
     Live migration of &vmguest;s is currently not supported by &suse;.
    </para>
   </listitem>
  </itemizedlist>

  <remark condition="clarity">
   2016-09-22 - fs: Do we support multipath for persistent disks?
   <link xlink:href="https://www.ibm.com/support/knowledgecenter/en/SSB27U_6.3.0/com.ibm.zvm.v630.hcpo4/multipath.htm"/>
  </remark>
 </sect1>

 <sect1 xml:id="app.deploy.zsystems.zvm">
  <title>Configuring z/VM</title>
  <para>
   Please refer to <link
   xlink:href="http://www.redbooks.ibm.com/abstracts/sg248147.html?Open">The
   Virtualization Cookbook for IBM z Systems Volume 1: IBM z/VM 6.3</link> for
   general instructions on how to configure z/VM. The following requirements
   need to be fulfilled:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     The IBM Directory Maintenance Facility (DIRMAINT) needs to be enabled
    </para>
   </listitem>
   <listitem>
    <para>
     The z/VM Systems Management API (SMAPI) needs to be enabled
    </para>
   </listitem>
   <listitem>
    <para>
     The latest APARs and PTFs for z/VM &ostack; Liberty support from <link
     xlink:href="http://www.vm.ibm.com/sysman/osmntlvl.html"/> need to be
     installed. Note that this Web page offers APARS and PTFs for &ostack;
     Liberty and Juno. This setup requires them for &ostack; Liberty only.
    </para>
   </listitem>
   <listitem>
    <para>
     Provide for preformatted Model 9 (or equivalent) system attached mini
     disks for the CMA. These disks will be used by &xcat; and be added to
     the disk pool XCAT1.
     <remark condition="clarity">
      2016-09-15 - fs: Where to find the README that explains how to set them
      up?
     </remark>
     FIXME: Provide instructions how to label them in the FAQ section
    </para>
   </listitem>
   <listitem>
    <para>
     Provided two Model 3 (or equivalent) mini disks to be added to the
     system as <literal>M0101</literal> and <literal>M0102</literal>. These
     disks are used to store the root disks of the &vmguest;s. Refer to the
     section
     <link
       xlink:href="https://www.ibm.com/support/knowledgecenter/en/SSB27U_6.3.0/com.ibm.zvm.v630.hcpo4/cmaenv.htm">Disk
     Storage: CMA Environment</link> in the IBM documentation for details.
    </para>
   </listitem>
   <listitem>
    <para>
     <remark condition="clarity">
      2016-10-13 - fs: Is this required in addition to the M0101 amd M0102
      disks or is this obsolete?
     </remark>
     Provide a single disk pool for disk space required for the
     &vmguest;s. It is not possible to use more than one disk pool for this
     purpose.
    </para>
   </listitem>
   <listitem>
    <para>
     &xcat; needs to be configured to have SMAPI access. Note that in previous
     CMA versions, ZHCP needed to have SMAPI access. This has changed with the
     CMA for &ostack; Liberty.
    </para>
   </listitem>
   <listitem>
    <para>
     Provide a real OSA device for &xcat;.
    </para>
   </listitem>
   <listitem>
    <para>
     Make sure to the IP address for &xcat; is accessible from within the
     company network.
    </para>
   </listitem>
  </itemizedlist>

  <remark condition="clarity">
   2016-09-22 - fs: Any differences to <link
   xlink:href="https://www.ibm.com/support/knowledgecenter/en/SSB27U_6.3.0/com.ibm.zvm.v630.hcpo4/config.htm"/> ??
  </remark>
 </sect1>

 <sect1 xml:id="app.deploy.zsystems.cma">
  <title>Configuring the CMA</title>
  <para>
   The CMA configuration is stored in the file <filename>DMSSICMO
   COPY</filename>. This section is about tailoring the default configuration
   to set up the CMA according to the CMA mn role (refer to <xref
   linkend="app.deploy.zsystems.setup"/> for details on this role).
  </para>
  <para>
   The <filename>DMSSICMO COPY</filename> file must reside on the MAINT 193
   disk only. Adjustments to the <filename>DMSSICMO COPY</filename> file should
   only be made locally using the automated local modification procedure. Make
   sure SMAPI and the &xcat; server are not running when editing file.
  </para>
  <procedure xml:id="pro.deploy.zsystems.dmssicmo">
   <title>Adjusting <filename>DMSSICMO COPY</filename></title>
   <step>
    <para>
     Log on as user MAINT or MAINT163 <remark condition="clarity"> 2016-10-14 -
     fs: Which one?</remark> to the z/VM system.
    </para>
   </step>
   <step>
    <para>
     Shut down SMAPI and &xcat; with the following command:
    </para>
    <screen>FORCE VSMGUARD</screen>
   </step>
   <step>
    <para>
     Create a local copy of <filename>DMSSICMO COPY</filename> using the
     following command:
    </para>
    <screen>LOCALMOD CMS DMSSICNF $COPY</screen>
    <para>
     In the upcoming dialog, select <guimenu>1</guimenu>. An XEDIT session in
     which you can adjust the default settings of the <filename>DMSSICMO
     COPY</filename> file will automatically start.
    </para>
   </step>
   <step>
    <para>
     Adjust the values listed below. Do not change values not listed below.
    </para>
    <variablelist>
     <varlistentry>
      <term><envar>cmo_data_disk</envar></term>
      <listitem>
       <para>
        A space-separated list of volume IDs of minidisks that are to be used
        by the CMA to store user data. These are the four preformatted Model 9
        mini disks you provided for the CMA. See <xref
        linkend="qa.zsystem.add.disks"/> for detailed instructions.
       </para>
       <screen>cmo_data_disk="<replaceable>volumeID1</replaceable> <replaceable>volumeID2</replaceable> <replaceable>volumeID3</replaceable> <replaceable>...</replaceable>"</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><envar>openstack_system_role</envar></term>
      <listitem>
       <para>
        This option needs to be set to <literal>mn</literal> to configure the
        CMA mn role.
       </para>
       <screen>openstack_system_role="mn"</screen>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step>
    <para>
     To save the <filename>DMSSICNF $COPY</filename> enter
     <literal>FILE</literal> followed by <keycap function="enter"/> on the
     XEDIT command line.
    </para>
   </step>
   <step>
    <para>
     Make the changes available by entering the following commands:
    </para>
    <screen>SERVICE CMS BUILD
PUT2PROD</screen>
   </step>
  </procedure>
  <para>
   The CMA is now configured. Proceed with <xref
   linkend="app.deploy.zsystems.xcat"/>.
  </para>
  </sect1>

 <sect1 xml:id="app.deploy.zsystems.xcat">
  <title>Configuring the &xcat; and ZHCP Servers</title>
  <para>
   Each &xcat; and CMA server requires a ZHCP server to communicate with
   SMAPI. Different setups are supported, however the configuration described
   in this document is a single z/VM running &xcat; and ZHCP in an integrated
   CMA (<literal>CMA mn</literal>). ZHCP is automatically started alongside
   &xcat; and both services are configured with the <filename>DMSSICNF
   COPY</filename> file.
  </para>
  <para>
   The <filename>DMSSICNF COPY</filename> file must reside on the MAINT 193
   disk only. Adjustments in the <filename>DMSSICNF COPY</filename> file should
   only be made locally using the automated local modification procedure. Make
   sure the &xcat; server is not running when editing file.
  </para>
  <procedure>
   <title>Adjusting <filename>DMSSICNF COPY</filename></title>
   <step>
    <para>
     Log on as user MAINT or MAINT163 <remark condition="clarity"> 2016-10-14 -
     fs: Which one?</remark> to the z/VM system.
    </para>
   </step>
   <step>
    <para>
     Shut down &xcat; with the following command:
    </para>
    <screen>FORCE VSMGUARD</screen>
   </step>
   <step>
    <para>
     Create a local copy of <filename>DMSSICNF COPY</filename> using the
     following command:
    </para>
    <screen>LOCALMOD CMS DMSSICNF $COPY</screen>
    <para>
     In the upcoming dialog, select <guimenu>1</guimenu>. An XEDIT session in
     which you can adjust the default settings of the <filename>DMSSICNF
     COPY</filename> file will automatically start.
    </para>
   </step>
   <step>
    <para>
     Set values matching your network configuration for the &xcat; server
     running on this z/VM instance:
    </para>
    <simplelist>
     <member><envar>XCAT_MN_Addr</envar> (IP address).</member>
     <member><envar>XCAT_MN_gateway</envar> (gateway).</member>
     <member><envar>XCAT_MN_Mask</envar>(network mask).</member>
     <member>
      <envar>XCAT_DOMAIN</envar> and <envar>ZHCP_Domain</envar> (domain name
      for the &xcat; and the ZHCP servers, for instance
      <literal>&exampledomain;</literal>).
     </member>
    </simplelist>
    <para>
     If you are running multiple &xcat; servers in your network, also set
     <envar>XCAT_Host</envar> to the host name of the server running on this
     z/VM instance.
    </para>
   </step>
   <step>
    <para>
     Set the value of <envar>XCAT_MN_OSAdev</envar> to the address of the real
     OSA device (first address of the triplet) of the &xcat; server. Note that
     you can only specify a single address here.
    </para>
   </step>
   <step>
    <para>
     It is recommended <emphasis>not</emphasis> to change the default values
     for
    </para>
    <simplelist>
     <member><envar>XCAT_vswitch</envar>=<literal>XCATVSW1</literal></member>
     <member>
      <envar>XCAT_MN_vswitch</envar>=<literal>XCATVSW2</literal>
     </member>
    </simplelist>
   </step>
   <step>
    <para>
     Set <envar>XCAT_zvmsysid</envar> to the id of this z/VM instance.
    </para>
   </step>
   <step>
    <para>
     Set <envar>XCAT_notify</envar> to the user ID that should receive start-up
     messages. If unset, these massages are automatically sent to <systemitem
     class="username">OPERATOR</systemitem>.
    </para>
   </step>
   <step>
    <para>
     Configure the login credentials for the &xcat; Web interface by setting
     <envar>XCAT_MNadmin</envar> to a user name and <envar>XCAT_MN_pw</envar>
     to a password of your choice. The password should be changed when logging
     in for the first time.
    </para>
   </step>
   <step>
    <para>
     To save the <filename>DMSSICNF $COPY</filename> enter
     <literal>FILE</literal> followed by <keycap function="enter"/> on the
     XEDIT command line.
    </para>
   </step>
   <step>
    <para>
     Make the changes available by entering the following commands:
    </para>
    <screen>SERVICE CMS BUILD
PUT2PROD</screen>
   </step>
  </procedure>
  <para>
   Since ZHCP is integrated in the CMA, the stand-alone ZHCP server needs to be
   prevented from being IPLed. This is achieved by editing <filename>DMSSISRV
   NAMES</filename> and commenting the ZHCP entry.
   <remark condition="clarity">
    2016-09-26 - fs: Should a local copy be created first? On which disk does
    this file reside?
   </remark>
  </para>
  <procedure>
   <title>Adjusting <filename>DMSSISRV NAMES</filename></title>
   <step>
    <para>
     Log on as user MAINT or MAINT163 <remark condition="clarity"> 2016-10-14 -
     fs: Which one?</remark> to the z/VM system.
    </para>
   </step>
   <step>
    <para>
     Create a local copy of <filename>DMSSISRV NAMES</filename> using the
     following command:
    </para>
    <screen>LOCALMOD CMS DMSSISRV NAMES</screen>
    <para>
     In the upcoming dialog, select <guimenu>1</guimenu>. An XEDIT session in
     which you can adjust the default settings of the <filename>DMSSISRV
     NAMES</filename> file will automatically start.
    </para>
   </step>
   <step>
    <para>
     Adjust the section <literal>* Node server for xcat</literal>. The result
     should look like the following:
    </para>
    <screen>* Node server for xcat
 * :server.ZHCP
 * :type.XCAT
 * :subtype.NODE</screen>
   </step>
   <step>
    <para>
     To save the <filename>DMSSISRV NAMES</filename> enter
     <literal>FILE</literal> followed by <keycap function="enter"/> on the
     XEDIT command line.
    </para>
   </step>
  </procedure>

  <para>
   To restart the &xcat; and ZHCP servers, proceed as follows:
  </para>
  <procedure>
   <title>Restarting &xcat; and ZHCP</title>
   <step>
    <para>
     Shut down and restart <remark>Correct terminology??</remark> VSMGUARD as
     an authorized user <remark>Correct terminology?? Which user?</remark>:
    </para>
    <screen>FORCE VSMGUARD
XAUTOLOG VSMGUARD</screen>
   </step>
   <step>
    <para>
     <remark>Correct terminology??</remark> Redirect the VSMGUARD log messages
     to the <systemitem class="username">xcat</systemitem> user ID, so you can
     check whether &xcat; and ZHCP have been restarted. The latter can take
     several minutes.
    </para>
    <screen>SET SECUSER XCAT *</screen>
   </step>
   <step>
    <para>
     Once the servers have been restarted, reset logging to the defaults by
     entering
    </para>
    <screen>SET SECUSER XCAT NONE</screen>
   </step>
   <step>
    <para>
     Check if the servers have been properly set up. Do so by browsing to the
     following Web page:
     <literal>https://<replaceable>XCAT_Host</replaceable>.<replaceable>XCAT_DOMAIN</replaceable>/xcat/</literal>. <replaceable>XCAT_Host</replaceable>
     and <replaceable>XCAT_DOMAIN</replaceable> need to be replaced by the
     respective values from <filename>DMSSICNF CONF</filename>. If you have not
     set <replaceable>XCAT_Host</replaceable>, use the IP address provided with
     <envar>XCAT_MN_Addr</envar>, for example <link
     xlink:href="https://&wsIVip;/xcat/"/>.
    </para>
   </step>
   <step>
    <para>
     <remark condition="clarity">
      2016-09-26 - fs: Is this true? IBM docs claim credentials are admin/admin
      by default?
     </remark>
     Log in to the &xcat; GUI using the credentials provided with
     <envar>XCAT_MNadmin</envar> and <envar>XCAT_MN_pw</envar> in the
     <filename>DMSSICNF CONF</filename>. At this point it is recommended to
     change the administrator password as described in <link
     xlink:href="https://www.ibm.com/support/knowledgecenter/en/SSB27U_6.3.0/com.ibm.zvm.v630.dmse6/xcatgui.htm"/>.
    </para>
   </step>
  </procedure>
  <para>
   If you can access the &xcat; GUI and login successfully, &xcat; and ZHCP
   have been properly set up and the CMA has been started. To finish the setup
   on the &zseries; side, continue with <xref
   linkend="sec.deploy.zsystems.image"/>.
  </para>

  <tip>
   <title>Providing SSH Access for &rootuser; to the &xcat; Server</title>
   <para>
    Although optional, it is strongly recommended to enable connecting via SSH
    to the &xcat; server. This makes it easier to run commands required to
    finish the setup. With SSH disabled, you can alternatively run these
    commands using the &xcat; Web interface.
   </para>
   <para>
    Log in to the &xcat; GUI and navigate to the script panel as described in
    <link
      xlink:href="https://www.ibm.com/support/knowledgecenter/en/SSB27U_6.3.0/com.ibm.zvm.v630.dmse6/usesp.htm#usesp"/>. Enter
    the following command into the script box and <guimenu>Run</guimenu> it:
   </para>
   <screen>echo "<replaceable>SSH-KEY</replaceable>" > /root/.ssh/authorized_keys</screen>
   <para>
    Replace <replaceable>SSH-KEY</replaceable> with the public SSH key of the
    user that should be allowed to log in via SSH as &rootuser;.
   </para>
  </tip>
 </sect1>


 <sect1 xml:id="sec.deploy.zsystems.image">
  <title>Capture a &slsa; on &zseries; Image</title>
  <para>
   To start a &vmguest; an Linux on &zseries; operating system image is
   required. In order to create such an image, you need to set up a &slsa; 12
   SP1 system running in the same z/VM than the CMA. Once the system has been
   intalled and configured, you can shut it down and capture the image. In the
   following this Linux system used to capture the image from is referred to as
   the <quote>image capture system</quote>.
  </para>

  <sect2 xml:id="sec.deploy.zsystems.image.requirements">
   <title>Requirements for the Image Capture System</title>
   <para>
    The following requirements for the image capture system need to be met:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Use &slsa; 12 SP1 as an operating system. This system has been tested and
      is known to work. &slsa; 11 SP4 and RHEL 6.2 - 7.2 may also work but have
      not been tested by &suse;).
     </para>
    </listitem>
    <listitem>
     <para>
      Use a minidisk with ECKD or FBA for storage. You must use the same type
      as is used for the disk pool for ephemeral storage, mixing ECKD and FBA
      is not possible. The minidisk must <emphasis>not</emphasis> be a
      full-pack disk and needs to be defined with the virtual address 0100.
     </para>
    </listitem>
    <listitem>
     <para>
      Network interfaces need to be configured with IPv4. Disabling IPv6 in the
      network settings is strongly recommended.
     </para>
    </listitem>
    <listitem>
     <para>
      The size of the root disk should not exceed 5 GB. It is also recommended
      to use a disk size with a full gigabyte value (for example 2GB or 3GB),
      since &ostack; disks are defined that way. See the <link
      xlink:href="http://ibmmainframes.com/references/disk.html">Mainframe Disk
      Capacity Table</link> for values that help to convert blocks or
      cyclinders to bytes.
     </para>
    </listitem>
    <listitem>
     <para>
      The root disk needs to have a single partition and the root file system
      must not be on a logical volume.
     </para>
    </listitem>
    <listitem>
     <para>
      The root file system needs to be formatted with Etx2, Etx3, Ext4, or
      XFS. Btrfs is currently not supported.
     </para>
    </listitem>
    <listitem>
     <para>
      The <systemitem class="daemon">sshd</systemitem> needs to run and the SSH
      port (22) needs to be opened in the firewall.
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="sec.deploy.zsystems.image.install">
   <title>Installing and Configuring the Image Capture System</title>
   <para>
    To install the image capture system, follow the default &slsa; for IBM
    &zseries; installation instructions that are available from the &suse; Web
    page: <link
    xlink:href="https://www.suse.com/documentation/sles-12/book_sle_deployment/data/cha_zseries.html">Installation
    on IBM z Systems</link>. <remark condition="clarity">2016-10-14 - fs:
    Should we rather refer to the Virtualization Coobook (SUSE part)?</remark>
    Make sure to fulfill the <xref
    linkend="sec.deploy.zsystems.image.requirements"/> when setting up the
    network and the partitions.
   </para>
   <para>
    Once the system has been installed, make the following adjustments:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Make sure the package <package>openssl</package> is installed
     </para>
    </listitem>
    <listitem>
     <para>
      SELinux must not be enabled (this is the default for &slsa; 12 SP1)
     </para>
    </listitem>
    <listitem>
     <para>
      The system needs to be accessible via SSH. Disable DNS lookuop for SSH by
      setting <literal>UseDNS no</literal> in
      <filename>/etc/ssh/sshd_config</filename>.
     </para>
    </listitem>
   </itemizedlist>
  </sect2>


  <sect2 xml:id="sec.deploy.zsystems.image.install.xcat_node">
   <title>Define the Image Capture System as an &xcat; Node</title>
   <para>
    Before you can create an image for the image capture system, you need to
    define it as a node to the &xcat; server.
   </para>
   <procedure>
    <step>
     <para>
      Log in to the &xcat; server via SSH as user &rootuser;.
     </para>
    </step>
    <step>
     <para>
      Run the following command:
     </para>
     <screen>/opt/xcat/bin/mkdef -t node -o <replaceable>HOSTNAME</replaceable>
userid=<replaceable>UID</replaceable> hcp=<replaceable>ZHCP_FQN</replaceable> mgt=zvm groups=all</screen>
     <para>
      Replace the following placeholders with appropriate values:
     </para>
     <variablelist>
      <varlistentry>
       <term><replaceable>HOSTNAME</replaceable></term>
       <listitem>
        <para>
         The image capture system's short host name, for example
         <literal>&wsI;</literal>
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><replaceable>UID</replaceable></term>
       <listitem>
        <para>
         The userid name of the image capture system.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><replaceable>ZHCP_FQN</replaceable></term>
       <listitem>
        <para>
         The fully qualified host name of the ZHCP server, for example
         <literal>zhcp.&exampledomain;</literal>
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </step>
    <step>
     <para>
      Update the node's properties by running the following command:
     </para>
     <screen>/opt/xcat/sbin/chtab node=HOSTNAME hosts.ip=<replaceable>IP_ADDRESS</replaceable> \
 hosts.hostnames=<replaceable>FQN</replaceable> noderes.netboot=zvm node.type.os=sles12.1 \
 nodetype.arch=s390x nodetype.profile=default nodetype.provmethod=netboot</screen>
     <para>
      Replace the following placeholders with appropriate values:
     </para>
     <variablelist>
      <varlistentry>
       <term><replaceable>HOSTNAME</replaceable></term>
       <listitem>
        <para>
         The image capture system's short host name, for example
         <literal>&wsI;</literal>
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><replaceable>IP_ADDRESS</replaceable></term>
       <listitem>
        <para>
         The IP address of the image capture system.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><replaceable>FQN</replaceable></term>
       <listitem>
        <para>
         The fully qualified host name of the image capture system, for
         example <literal>&wsIname;</literal>.
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </step>
    <step>
     <para>
      Create the host:
     </para>
     <screen>/opt/xcat/sbin/makehosts</screen>
    </step>
    <step>
     <para>
      Log in to the &xcat; GUI and click <menuchoice> <guimenu>Node</guimenu>
      <guimenu>Nodes</guimenu> </menuchoice>. Start the image capture system by
      choosing <guimenu>Power On</guimenu> from it's <guimenu>Actions</guimenu>
      menu in the.
     </para>
     <note>
      <title>System Start-Up</title>
      <para>
       Starting the image capture system may take several minutes. Sometimes
       the status is not properly updated in the &xcat; GUI and the machine is
       reported to be <literal>OFF</literal>, although it is already
       running. You can use <command>ping
       <replaceable>IP_ADDRESS</replaceable></command> to check whether the
       machine has started.
      </para>
     </note>
    </step>
    <step>
     <para>
      To allow &xcat; to communicate with the image capture system, you need to
      unlock it via the &xcat; GUI:
     </para>
     <substeps>
      <step>
       <para>
        Click <menuchoice><guimenu>Nodes</guimenu> <guimenu>Groups</guimenu>
        <guimenu>All</guimenu> <guimenu>Nodes panel</guimenu></menuchoice>.
       </para>
      </step>
      <step>
       <para>
        Activate the image capture system via the check box.
       </para>
      </step>
      <step>
       <para>
        Now select <menuchoice><guimenu>Configuration</guimenu>
        <guimenu>Unlock</guimenu></menuchoice>.
       </para>
      </step>
      <step>
       <para>
        In the dialog that launches, specify the &rootuser; password and finish
        by clicking <guimenu>Unlock</guimenu>.
       </para>
      </step>
     </substeps>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.deploy.zsystems.image.install.xcatconf4z">
   <title>Deploy the <literal>xcatconf4z</literal> Service</title>
   <para>
    <literal>xcatconf4z</literal> service allows &xcat; to inject changes to a
    system that is currently not running. The changes are applied the next time
    the system starts. This feature is required on the image capture system. To
    make it available, deploy <literal>xcatconf4z</literal>:
   </para>
   <procedure>
    <step>
     <para>
      Log in to the &xcat; node via ssh as &rootuser;.
     </para>
    </step>
    <step>
     <para>
      Copy the <literal>xcatconf4z</literal> files to the image capture system:
     </para>
     <screen>cd /opt/xcat/share/xcat/scripts
scp xcatconf4z xcatconf4z.service <replaceable>ICS</replaceable>:/tmp</screen>
     <para>
      Replace <replaceable>ICS</replaceable> with the host name or the IP
      address of the image captue system.
     </para>
    </step>
    <step>
     <para>
      Log in to the image captue system as &rootuser;.
     </para>
    </step>
    <step>
     <para>
      Edit <filename>/tmp/xcatconf4z</filename> and set
      <literal>authorizedSenders</literal> to <literal>*</literal>.
     </para>
    </step>
    <step>
     <para>
      Edit <filename>/tmp/xcatconf4z.service</filename> and set the following
      values as shown below:
     </para>
     <screen>ExecStart=/usr/local/bin/xcatconf4z
NatworkManagerService=wicked.service</screen>
    </step>
    <step>
     <para>
      Move the xcatconf4z files to the correct locations and make the script
      executable:
     </para>
     <screen>mv /tmp/xcatconf4z /usr/local/bin/
mv /tmp/xcatconf4z.service /etc/systemd/system/
chmod 755 /usr/local/bin/xcatconf4z</screen>
    </step>
    <step>
     <para>
      Enable and start the xcatconf4z service. Check its status
      afterwards&mdash;it should report xcatconf4z as being active and running.
     </para>
     <screen>systemctl enable xcatconf4z
systemctl start xcatconf4z
systemctl status xcatconf4z</screen>
    </step>
   </procedure>
  </sect2>
 </sect1>


  <sect1 xml:id="app.deploy.zsystems.faq">
  <title>Frequently Asked Questions</title>
  <qandaset>
   <qandaentry xml:id="qa.zsystem.add.disks">
    <question>
     <para>
      How to provide the disks for the CMA? How to add disks at a later stage?
     </para>
    </question>
    <answer>
     <procedure>
      <step>
       <para>
        Format the disk(s) using <command>CPFMTXA</command>. Only
        CPFMTXA-formatted disks can be used by the CMA.
       </para>

       <tip>
        <title>Disk Labeling</title>
        <para>
         If you follow the disk labeling schema of the <link
         xlink:href="http://www.redbooks.ibm.com/abstracts/sg248147.html?Open">Virtualization
         Cookbook</link>, you might want to set an extra type letter for that
         disks.  For example, if your LPAR letter is "J", the type could be
         "X". A disk with the number 6010 can then be formatted as MAINT with
         the following commands:
        </para>
        <screen>ATTACH 6010 *
CPFMTXA 6010#format#0-1#JX6010#YES#END
DETACH 6010</screen>
       </tip>
      </step>
      <step>
       <para>
        To make the disk persistently available to z/VM, first do a system
        attach of the disk. Also attach the disk during startup of z/VM. Note
        that you must not add the disk to a directory manager disk group.
       </para>
      </step>
      <step>
       <para>
        Add the disk ID that was returned by the <command>CPFMTXA</command>
        command to the <envar>cmo_data_disk</envar> entry in the
        <filename>DMSSICMO COPY</filename> file as described in <xref
        linkend="pro.deploy.zsystems.dmssicmo"/>.
       </para>
      </step>
     </procedure>
     <para>
      All disks that are added this way will be added to a disk pool named
      XCAT1. New disks will be added to that pool every time the CMA logs on.
     </para>

     <tip>
      <title>Specifying a Value on Multiple Lines</title>
      <para>
       The maximum number of characters per line in <filename>DMSSICMO
       COPY</filename> is limited to 90 characters. In case you need to enter
       the disk IDs on multiple lines, start the value with a double quote on
       the first line and end it with a double quote on the last line. Each
       line that is continued, also needs to end with a space.
      </para>
      <screen>cmo_data_disk="<replaceable>volumeID1</replaceable> <replaceable>volumeID2</replaceable> <replaceable>volumeID3</replaceable> <replaceable>volumeID4</replaceable>
<replaceable>volumeID5</replaceable> <replaceable>volumeID6</replaceable>
<replaceable>volumeID7</replaceable>"</screen>
     </tip>
    </answer>
   </qandaentry>
<!--
   <qandaentry>
    <question>
     <para>
      How to attach disks to SYSTEM CONFIG?
     </para>
    </question>
    <answer>
     <para>
      TBD by bg
     </para>
    </answer>
   </qandaentry>
   <qandaentry>
    <question>
     <para>
      How to give &xcat; appropriate permissions to access SMAPI?
     </para>
    </question>
    <answer>
     <para>
      TBD by bg
     </para>
    </answer>
   </qandaentry>
   <qandaentry>
    <question>
     <para>
      How to create or modify a disk pool for instances for ECKD?
     </para>
    </question>
    <answer>
     <para>
      TBD by bg
     </para>
    </answer>
   </qandaentry>
   <qandaentry>
    <question>
     <para>
      How to create or modify a disk pool for instances for FBA?
     </para>
    </question>
    <answer>
     <para>
      TBD by bg
     </para>
    </answer>
   </qandaentry>
-->
  </qandaset>
  </sect1>
</appendix>
