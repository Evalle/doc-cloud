<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE appendix
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<!-- Converted by suse-upgrade version 1.1 -->
<appendix xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="app.deploy.zsystems">
 <title>IBM &zseries; Installation Instructions</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer>fs</dm:maintainer>
   <dm:status>editing</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>no</dm:translation>
   <dm:languages/>
  </dm:docmanager>
 </info>
 <para>
  &cloud; supports the &o_comp; ZVMDriver driver which manages communication
  between &ostack; and a z/VM hypervisor to deploy and manage &vmguest;s
  on z/VM. &productname; does not natively support managing and deploying z/VM
  &vmguest;s&mdash;it delegates requests to an &xcat; server running on
  z/VM. This requires a proper setup on the &zseries; side and a single
  &comp; node on the &cloud; side.
 </para>
 <para>
  IBM supports different ways to set up the &zseries; side. This document
  describes the setup outlined in FIXME&mdash;it has been tested by &suse;
  and is known to work. Additional documentation providing in-depth information
  to topics also covered in this document are available from IBM and can be
  retrieved from the IBM Knowledge Center for z/VM 6.3.0:
 </para>
 <itemizedlist>
  <listitem>
   <para>
    <link xlink:href="https://www.ibm.com/support/knowledgecenter/en/SSB27U_6.3.0/com.ibm.zvm.v630.hcpo4/toc.htm">z/VM Enabling z/VM for OpenStack (Support for OpenStack Liberty Release)</link>
   </para>
  </listitem>
  <listitem>
   <para>
    <link xlink:href="https://www.ibm.com/support/knowledgecenter/en/SSB27U_6.3.0/com.ibm.zvm.v630.dmse6/toc.htm">z/VM: Systems Management Application Programming</link>
   </para>
  </listitem>
 </itemizedlist>
 <para>
  Note, that these manuals contain procedures and setups not tested by
  &suse; or not working with &cloud;. Links to sections covering topics
  described in this manual are provided in the respective sections.
 </para>
 <sect1 xml:id="app.deploy.zsystems.setup">
  <title>IBM &zseries;: Supported Setup</title>
  <para>
   To manage and deploy &vmguest;s on z/VM with &cloud;, a z/VM running the
   Cloud Manager Appliance (CMA), the Extreme Cloud Administration Toolkit
   (&xcat;) and a Linux system used to capture an image from, is required.
   The setup described in this document uses the following components and
   configurations:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     The &xcat; and the ZHCP servers are running in the CMA (<literal>CMA
     nm</literal> role)
    </para>
   </listitem>
   <listitem>
    <para>
     Communication between &xcat; and &productname; is done by a single &cloud;
     &comp; node that is deployed and configured from &productname;. This
     &comp; node needs to be an <literal>x86_64</literal> machine.
    </para>
   </listitem>
   <listitem>
    <para>
     The &vmguest; image runs &slsa; 12.1 for IBM &zseries; and uses ECKD for
     storage.
    </para>
   </listitem>
  </itemizedlist>

  <remark condition="clarity">
   2016-09-22 - fs: Do we support live migration? (requires SSI setup)
   <link xlink:href="https://www.ibm.com/support/knowledgecenter/en/SSB27U_6.3.0/com.ibm.zvm.v630.hcpo4/zvmsys.htm"/>
  </remark>
  <remark condition="clarity">
   2016-09-22 - fs: Do we support multipath for persistent disks?
   <link xlink:href="https://www.ibm.com/support/knowledgecenter/en/SSB27U_6.3.0/com.ibm.zvm.v630.hcpo4/multipath.htm"/>
  </remark>
  <remark condition="clarity">
   2016-09-22 - fs: Which network configuration do we support?
   <link
     xlink:href="https://www.ibm.com/support/knowledgecenter/en/SSB27U_6.3.0/com.ibm.zvm.v630.hcpo4/networkcon.htm"/> ff.
  </remark>

 </sect1>
 <sect1 xml:id="app.deploy.zsystems.requirements">
  <title>IBM &zseries;: Requirements</title>
  <para>
   The following requirements must be met before you can start setting up the
   CMA, &xcat;, and the Linux image capture system:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     Provide a z/VM 6.3.0 instance installed with SMAPI and DIRMAINT with the
     following setup:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       The latest APARs and PTFs for z/VM &ostack; Liberty support from <link
       xlink:href="http://www.vm.ibm.com/sysman/osmntlvl.html"/> need to be
       installed. Note that this Web page offers APARS and PTFs for &ostack;
       Liberty and Juno. This setup requires them for &ostack; Liberty only.
      </para>
     </listitem>
     <listitem>
      <para>
       Provide seven preformatted Model 9 (or equivalent) system attached mini
       disks for the CMA.
       <remark condition="clarity">
        2016-09-15 - fs: Where to find the README that explains how to set them
        up?
       </remark>
      </para>
      <para>
       <remark condition="clarity">
        2016-09-15 - fs: IIRC we did not use the 7 disks but rather:
       </remark>
       Provided two Model 3 (or equivalent) mini disks to be added to the system
       as <literal>M0101</literal> and <literal>M0102</literal>.
      </para>
     </listitem>
     <listitem>
      <para>
       Provide a storage pool for &vmguest;s.
       <remark condition="clarity">
        2016-09-15 - fs: we should be more specific here
       </remark>
      </para>
     </listitem>
     <listitem>
      <para>
       &xcat; needs to be configured to have SMAPI access.
      </para>
     </listitem>
     <listitem>
      <para>
       Provide a real OSA device for &xcat;.
      </para>
     </listitem>
     <listitem>
      <para>
       Make sure to the IP address for &xcat; is accessible from within the
       company network (do not use an address from the &cloud; network or any
       other isolated network).
      </para>
     </listitem>
    </itemizedlist>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="app.deploy.zsystems.zvm">
  <title>Configuring z/VM</title>
  <para/>

  <remark condition="clarity">
   2016-09-22 - fs: Any differences to <link
   xlink:href="https://www.ibm.com/support/knowledgecenter/en/SSB27U_6.3.0/com.ibm.zvm.v630.hcpo4/config.htm"/> ??
  </remark>
 </sect1>

 <sect1 xml:id="app.deploy.zsystems.xcat">
  <title>Configuring the &xcat; and ZHCP Servers</title>
  <para>
   Each &xcat; and CMA server requires a ZHCP server to communicate with
   SMAPI. Different setups are supported, however the configuration described
   in this document is a single z/VM running &xcat; and ZHCP in an integrated
   CMA (<literal>CMA nm</literal>). ZHCP is automatically started alongside
   &xcat; and both services are configured with the <filename>DMSSICNF
   COPY</filename> file.
  </para>
  <para>
   The <filename>DMSSICNF COPY</filename> file must reside on the MAINT 193
   disk only. Adjustments in the <filename>DMSSICNF COPY</filename> file should
   only be made locally using the automated local modification procedure. Make
   sure the server is not running when editing file.
   <remark condition="clarity">
    2016-09-22 - fs: Which server? How to stop it?
   </remark>
  </para>
  <procedure>
   <title>Adjusting <filename>DMSSICNF COPY</filename></title>
   <step>
    <para>
     Log on to the maintenance user ID on the z/VM system.
    </para>
   </step>
   <step>
    <para>
     Create a local copy of <filename>DMSSICNF COPY</filename> using the
     following command:
    </para>
    <screen>LOCALMOD CMS DMSSICNF $COPY</screen>
    <para>
     An XEDIT session in which you can adjust the default settings of the
     <filename>DMSSICNF COPY</filename> file will automatically start.
    </para>
   </step>
   <step>
    <para>
     Set values matching your network configuration for the &xcat; server
     running on this z/VM instance:
    </para>
    <simplelist>
     <member><envar>XCAT_MN_Addr</envar> (IP address).</member>
     <member><envar>XCAT_MN_gateway</envar> (gateway).</member>
     <member><envar>XCAT_MN_Mask</envar>(network mask).</member>
     <member>
      <envar>XCAT_DOMAIN</envar> and <envar>ZHCP_Domain</envar> (domain name
      for the &xcat; and the ZHCP servers, for example &exampledomain;).
     </member>
    </simplelist>
    <para>
     If you are running multiple &xcat; servers in your network, also set
     <envar>XCAT_Host</envar> to the host name of the server running on this
     z/VM instance.
    </para>
   </step>
   <step>
    <para>
     Set the value of <envar>XCAT_MN_OSAdev</envar> to the address of the real
     OSA device (first address of the triplet) of the &xcat; server. Note that
     you can only specify a single address here.
    </para>
   </step>
   <step>
    <para>
     It is recommended not to change the default values for
    </para>
    <simplelist>
     <member><envar>XCAT_vswitch</envar>=<literal>XCATVSW1</literal></member>
     <member>
      <envar>XCAT_MN_vswitch</envar>=<literal>XCATVSW2</literal>
     </member>
    </simplelist>
   </step>
   <step>
    <para>
     Set <envar>XCAT_zvmsysid</envar> to the id of this z/VM instance.
    </para>
   </step>
   <step>
    <para>
     Set <envar>XCAT_notify</envar> to the user ID that should receive start-up
     messages. If unset, these massages are automatically sent to <systemitem
     class="username">OPERATOR</systemitem>.
    </para>
   </step>
   <step>
    <para>
     <remark condition="clarity">
      2016-09-26 - fs: Is this true? I made a note that these are the
      credentials for the Web front-end rather than for SSH.
     </remark>
     Although optional, it is strongly recommended to enable connecting via SSH
     to the &xcat; server. This makes it easier to run commands required to
     finish the setup. With SSH disabled, you can alternatively run these
     commands using the &xcat; Web interface.
    </para>
    <para>
     To enable SSH set <envar>XCAT_MNadmin</envar> to a user name and
     <envar>XCAT_MN_pw</envar> to a password of your choice. The password
     should be changed when logging in via SSH for the first time.
    </para>
   </step>
   <step>
    <para>
     To save the <filename>DMSSICNF $COPY</filename> enter
     <literal>FILE</literal> followed by <keycap function="enter"/> on the
     XEDIT command line.
    </para>
   </step>
   <step>
    <para>
     Make the changes available by entering the following commands:
    </para>
    <screen>SERVICE CMS BUILD
PUT2PROD</screen>
   </step>
  </procedure>
  <para>
   Since ZHCP is integrated in the CMA, the stand-alone ZHCP server needs to be
   prevented from being IPLed. This is achieved by editing <filename>DMSSISRV
   NAMES</filename> and commenting the ZHCP entry. The result should look like
   the following:
   <remark condition="clarity">
    2016-09-26 - fs: Should a local copy be created first? On which disk does
    this file reside?
   </remark>
  </para>
  <screen>* Node server for xcat
 * :server.ZHCP
 * :type.XCAT
 * :subtype.NODE</screen>
  <para>
   To restart the &xcat; and ZHCP servers, proceed as follows:
  </para>
  <procedure>
   <title>Restarting &xcat; and ZHCP</title>
   <step>
    <para>
     Shut down and restart <remark>Correct terminology??</remark> VSMGUARD as
     an authorized user <remark>Correct terminology?? Which user?</remark>:
    </para>
    <screen>FORCE VSMGUARD
XAUTOLOG VSMGUARD</screen>
   </step>
   <step>
    <para>
     <remark>Correct terminology??</remark> Redirect the VSMGUARD log messages
     to the <systemitem class="username">xcat</systemitem> user ID, so you can
     check whether &xcat; and ZHCP have been restarted. The latter can take
     several minutes.
    </para>
    <screen>set secuser xcat *</screen>
   </step>
   <step>
    <para>
     Once the servers have been restarted, reset logging to the defaults by
     entering
    </para>
    <screen>set secuser xcat none</screen>
   </step>
   <step>
    <para>
     Check if the servers have been properly set up. Do so by browsing to the
     following Web page: <link
     xlink:href="https://XCAT_Host.XCAT_DOMAIN/xcat/"/>. <replaceable>XCAT_Host</replaceable>
     and <replaceable>XCAT_DOMAIN</replaceable> need to be replaced by the
     respective values from <filename>DMSSICNF CONF</filename>. If you have not
     set <replaceable>XCAT_Host</replaceable>, use the IP address provided with
     <envar>XCAT_MN_Addr</envar>, for
     example <link xlink:href="https://&wsIVip;/xcat/"/>.
    </para>
   </step>
   <step>
    <para>
     <remark condition="clarity">
      2016-09-26 - fs: Is this true? IBM docs claim credentials are admin/admin
      by default?
     </remark>
     Log in to the &xcat; GUI using the credentials provided with
     <envar>XCAT_MNadmin</envar> and <envar>XCAT_MN_pw</envar> in the
     <filename>DMSSICNF CONF</filename>. At this point it is recommended to
     change the administrator password as described in <link
     xlink:href="https://www.ibm.com/support/knowledgecenter/en/SSB27U_6.3.0/com.ibm.zvm.v630.dmse6/xcatgui.htm"/>.
    </para>
   </step>
  </procedure>
  <para>
   If you can access the &xcat; GUI and login successfully, &xcat; and ZHCP
   have been properly set up.
  </para>

  <tip>
   <title>Providing SSH Access for &rootuser; to the &xcat; Server</title>
   <para>

    <remark condition="clarity">
     2016-09-26 - fs: Clarify whether <envar>XCAT_MNadmin</envar> and
     <envar>XCAT_MN_pw</envar> are SSH credentials or used for the XCAT GUI
    </remark>
    Although optional, it is strongly recommended to enable connecting via SSH
    to the &xcat; server. This makes it easier to run commands required to
    finish the setup. With SSH disabled, you can alternatively run these
    commands using the &xcat; Web interface.
   </para>
   <para>
    <remark condition="clarity">
     2016-09-27 - fs: What about ssh-copy-id?
    </remark>
    Log in to the &xcat; GUI and navigate to the script panel as described in
    <link
      xlink:href="https://www.ibm.com/support/knowledgecenter/en/SSB27U_6.3.0/com.ibm.zvm.v630.dmse6/usesp.htm#usesp"/>. Enter
    the following command into the script box and <guimenu>Run</guimenu> it:
   </para>
   <screen>echo "<replaceable>SSH-KEY</replaceable>" > /root/.ssh/authorized_keys</screen>
   <para>
    Replace <replaceable>SSH-KEY</replaceable> with the public SSH key of the
    user that should be allowed to log in via SSH as &rootuser;.
   </para>
  </tip>
 </sect1>
 <sect1 xml:id="app.deploy.zsystems.cma">
  <title>Configuring the CMA</title>
  <para>
  </para>
 </sect1>
</appendix>
