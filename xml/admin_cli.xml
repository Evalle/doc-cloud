<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet
 href="urn:x-daps:xslt:profiling:novdoc-profile.xsl" 
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "IGNORE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<chapter id="cha.adm.cli">
 <title>Using &ostack; Command Line Interfaces</title>
 <abstract>
  <para>The &ostack; project provides a variety of command line tools with
   which you can manage the services within your cloud and automate 
   administration tasks by using scripts. Each of the core &ostack; components 
   has its own command line tool.</para>
 </abstract>
 <!--taroth 2012-07-31: implementation of unified command lines tools is WIP:
  http://wiki.openstack.org/UnifiedCLI, 
  http://wiki.openstack.org/UnifiedCLI/Mapping, 
  http://wiki.openstack.org/UnifiedCLI/HumanInterfaceGuidelines,
  glance client  is part of that unifcation effort-->
 <sect1 id="cha.adm.cli.oview">
  <title>&ostack; Commands&mdash;Overview </title>
  <para>The following command line tools are available for the respective
  services' APIs:<remark>taroth 2012-08-03: DEVs, please check if list is correct 
  and complete</remark>
  </para>
  <variablelist>
   <varlistentry>
    <term>
     <command>keystone</command>
    </term>
    <listitem>
     <para>For managing users and projects. 
     Provided by the <systemitem class="resource">python-keystoneclient</systemitem> 
     package.</para>
     <!--taroth 2012-08-03:check: or <systemitem
     class="resource">openstack-keystone</systemitem> package???-->
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>
     <command>nova</command>
    </term>
    <listitem>
     <para>For managing instances and flavors. Provided by the 
     <systemitem class="resource">python-novaclient</systemitem> package.</para>
      <!--taroth 2012-08-03:check: or <systemitem
     class="resource">openstack-nova</systemitem> package???-->
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>
     <command>glance</command>
    </term>
    <listitem>
     <para>For managing images. Provided by the 
     <systemitem class="resource">python-glanceclient</systemitem> package.</para>
      <!--taroth 2012-08-03:check: or <systemitem
     class="resource">openstack-glance</systemitem> package???-->
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>
     <command>swift</command>
    </term>
    <listitem>
     <para>For managing the object store. Provided by the 
     <systemitem class="resource">openstack-swift</systemitem> package.</para>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>The &ostack; project currently aims to unify the multiple command line 
  tools. For details, refer to <ulink url="http://wiki.openstack.org/UnifiedCLI"/>
  and <ulink url="http://wiki.openstack.org/UnifiedCLI/Mapping"/>. Commands for 
  tasks that may alos may executed from outside the cloud have recently been moved
  to the <literal>openstack-<replaceable>SERVICENAME</replaceable>
   </literal>
  packages.<remark>taroth 2012-08-06: DEVs is the following correct?</remark>
  Therefore, divergent variants of the command line tools are currently available:
  the older ones are contained in the packages 
  <literal>openstack-<replaceable>SERVICENAME</replaceable>
   </literal>, the newer
  ones in the packages <literal>python_<replaceable>SERVICE</replaceable>client</literal>. 
  As those packages conflict, you cannot install both variants of a command in 
  parallel.
  </para>
  <para>
   <remark>taroth 2012-08-06: DEVs, is the following true for the old or new version
 of the commands or for both?</remark>
 Help and detailed information about the individual options for the commands
 are available with</para>
  <screen>
   <replaceable>COMMAND</replaceable> help</screen>
  <para>or</para>
  <screen>
   <replaceable>COMMAND</replaceable> help <replaceable>SUBCOMMAND</replaceable>
  </screen>
  <para>For example: <command>glance&nbsp;help</command> or <command>glance&nbsp;help&nbsp;add</command>
  </para>
 </sect1>
 <sect1 id="sec.adm.cli.rc">
  <title>&ostack; RC File</title>
  <para>To set the necessary environment variables for the &ostack; command line
  tools, you need to download and source an environment file, 
  <filename>openrc.sh</filename>. It is project-specific and contains the 
  credentials used by &comp;, &img;, and &ident; services. You can download it
  from the &cloud; &dash;, either as user <systemitem class="user">admin</systemitem>
  or as any other user.
  </para>
  <procedure id="pro.adm.download.openrc">
   <title>Downloading the &ostack; RC File</title>
   <step>
    <para>Log in to the &cloud; &dash;.</para>
   </step>
   <step>
    <para>In the top-level row of the main screen, click 
    <menuchoice><guimenu>Settings</guimenu>
      <guimenu>&ostack; Credentials</guimenu>
     </menuchoice>.</para>
   </step>
   <step>
    <para>Select the project for which you want to download the &ostack; RC
     file, click <guimenu>Download RC File</guimenu> and save the file.
     </para>
   </step>
   <step>
    <para>Copy the <filename>openrc.sh</filename> file to the machine
     on which you want execute &ostack; commands, like uploading an image with
     the <command>glance</command> command.
     </para>
   </step>
   <step>
    <para>On any shell that you want to execute &ostack; comands from, 
    source the <filename>openrc.sh</filename> file for the respective
    project:</para>
    <screen>source openrc.sh</screen>
    <para>You will be prompted for an &ostack; password.</para>
   </step>
   <step>
    <para>Enter the &ostack; password of the user who downloaded the 
    <filename>openrc.sh</filename> file.
    </para>
    <para>With sourcing the file and entering the password, environment 
     variables are set for that shell. They allow any &ostack; commands to 
     communicate to the &ostack; services running in the cloud.</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sec.adm.cli.img">
  <title>Managing Images</title>
  <remark>taroth 2012-08-06: is image management generally a task executed
   by the cloud admin? or can a user also upload and manage images?</remark>
  <remark>taroth 2012-08-06: todo - cover image management in general 
   (glance delete, clear, image-member etc.), see 
   http://docs.openstack.org/developer/glance/glance.html </remark>
  <para>Images can only be uploaded to &productname; with the 
 <command>glance</command> line tool. 
  </para>
  <sect2 id="sec.adm.cli.img.build">
   <title>Building Images with &susestudio;</title>
   <para>To build the images to use within the cloud, use &susestudio; or 
   &suseonsite;. For detailed information on how to build appliance images, refer 
   to the <citetitle>&suseonsite; Quick Start</citetitle> or the 
   <citetitle>&suseonsite; User Guide</citetitle>, available at 
   <ulink url="http://www.suse.com/documentation/suse_studio/"/>.</para>
   <note>
    <title>Image Requirements</title>
    <para>Make sure any images that you build for the cloud fulfill the following
   requirements:</para>
    <itemizedlist>
     <listitem>
      <para>The network is set to DHCP.</para>
     </listitem>
     <listitem>
      <para>The image does not include &yast;2 Firstboot.</para>
     </listitem>
     <listitem>
      <para>The image does not include any end-user license agreements (EULA)
       dialogs.</para>
     </listitem>
     <listitem>
      <para>The image contains the following package: 
      <systemitem class="resource">suse-ami-tools</systemitem>. The ami tools 
      are used for communication with the metadata API <remark>taroth 2012-08-01:
      DEVs, in &ostack;?</remark> and to pull keypairs into the virtual machine 
      that will run the image.</para>
     </listitem>
     <listitem>
      <para>The image has the following format: <literal>USB/Harddisk</literal>.
      </para>
     </listitem>
    </itemizedlist>
   </note>
  </sect2>
  <sect2 id="sec.adm.cli.img.upload">
   <title>Adding Images</title>
   <para>After you have created one or multiple images as described in 
   <xref linkend="sec.adm.cli.img.build"/>, convert them to <literal>qcow2</literal>
   format and upload them to &productname; as follows.</para>
   <procedure id="pro.adm.cli.img.convert">
    <title>Converting Disk Images to <literal>qcow2</literal> Format</title>
    <para>The <literal>qcow2</literal> format helps to optimize disk space as 
     it consumes disk space only when contents are written on it.</para>
    <step>
     <para>Make sure the <systemitem class="resource">virt-utils</systemitem> 
    package is installed on the machine used for conversion.</para>
    </step>
    <step>
     <para>Download the disk image from &susestudio;.</para>
    </step>
    <step>
     <para>Convert the image:</para>
     <screen>qemu -img convert -c -f raw -O qcow2 <replaceable>image_file</replaceable>
      <replaceable>final_image_file</replaceable>
     </screen>
    </step>
   </procedure>
   <procedure id="pro.adm.cli.img.upload">
    <title>Uploading Disk Images to &productname;</title>
    <para>The following procedure shows how to upload a disk image using the
   <command>glance</command> variant that is contained in the package
   <systemitem class="resource">openstack-glance</systemitem>.</para>
    <step>
     <para>Copy the <literal>qcow2</literal> image to the &contrnode;.
    <remark>taroth 2012-08-02: DEVs, is that correct? if I used the 
    glance client instead, can I upload the image from *anywhere*?</remark>
     </para>
    </step>
    <step>
     <para>
      In a shell, source the &ostack; RC file for the project that you
      want to upload an image to. For details, refer to 
      <xref linkend="sec.adm.cli.rc"/>.
     </para>
    </step>
    <step>
     <para>Upload the image with the following command:</para>
     <screen>glance add name="<replaceable>image_name</replaceable>" is_public=True container_format=bare \
   disk_format=qcow2 &lt; <replaceable>path_to_final_image_file</replaceable>
     </screen>
     <para>Glance does not check any image properties during upload, 
     therefore you need to specify the image's properties as command line options.</para>
     <!--taroth 2012-08-07: either move the following to phrases in entity-decl.ent 
     or to separate overview chapter-->
     <itemizedlist>
      <listitem>
       <para>
        <option>name</option> (optional): Specifies a name with which the image will be listed
       in the &cloud; &dash; and in the command line interface.</para>
      </listitem>
      <listitem>
       <para>
        <option>is_public</option> (optional): Boolean value, default: 
        <literal>false</literal>. If set to <literal>true</literal>,
       the image is publicly available.<remark>taroth 2012-08-03: DEVs, what does 
       "publicly available" mean here? the image can be used (=a VM with this image 
       can be started) by any cloud user? can images also be bound to a certain project?
       what happens if the option is set to "false"?</remark>
       </para>
      </listitem>
      <listitem>
       <para>
        <option>container_format</option> (required):<remark>taroth 2012-08-03: DEVs, why 
        use "bare" here? the help text of the option is confusing and even 
        contradictory, so I cannot make sense any sense of that...</remark>
        For details, refer to 
      <ulink url="http://docs.openstack.org/developer/glance/formats.html"/>.
       </para>
      </listitem>
      <listitem>
       <para>
        <option>disk_format</option> (required): Specifies the disk format. In this case:
        <literal>qcow2</literal>
       </para>
      </listitem>
     </itemizedlist>
     <para>A message shows if the image upload has been successfull. The uploaded 
    image appears in the list of images that can be viewed with 
    <command>glance index</command>. It is also shown in the &cloud; &dash; (on 
    the <guimenu>Admin</guimenu> tab in the <guimenu>Images</guimenu> category).</para>
    </step>
   </procedure>
   <note>
    <title>Updating Images</title>
    <para>After having uploaded an image to &cloud;, the image contents cannot be
   modified (only the image's metadata). To update image contents, you need to
   delete the current image and upload a modified version of the image.</para>
   </note>
   <para>To modify the metadata of an image, use the <command>glance update</command>
  command.</para>
  </sect2>
  <sect2 id="sec.adm.cli.img.view">
   <title>Viewing Images and Image Properties</title>
   <para>In the following, find some examples on how to view publicly available 
   images or their properties with <command>glance</command> commands. </para>
   <variablelist>
    <varlistentry>
     <term>Listing Images</term>
     <listitem>
      <screen></screen>

     </sect2>
     <sect2 id="sec.adm.cli.img.remove">
      <title>Removing Disk Images from Glance</title>
      <para></para>
     </sect2>
     <sect2 id="sec.adm.cli.img.member">
      <title>Modifying Image Membership</title>
      <para></para>
     </sect2>
    </sect1>

   </chapter>
